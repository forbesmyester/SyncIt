<!DOCTYPE html>
<html>
<head>
  <title>SyncIt.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "SyncIt.js", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h2">
        <a href="#syncit">SyncIt</a>
      </div>
      <div class="heading h3">
        <a href="#new%20syncit()">new SyncIt()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.setclonefunction()">SyncIt.setCloneFunction()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getmodifier()">SyncIt.getModifier()</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenforconflictresolutionaddedtopath()">SyncIt.listenForConflictResolutionAddedToPath()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenfordatachange()">SyncIt.listenForDataChange()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenforaddedtopath()">SyncIt.listenForAddedToPath()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenforadvanced()">SyncIt.listenForAdvanced()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenforfed()">SyncIt.listenForFed()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.set()">SyncIt.set()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.remove()">SyncIt.remove()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.update()">SyncIt.update()</a>
      </div>
      <div class="heading h4">
        <a href="#example">Example</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.feed()">SyncIt.feed()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.advance()">SyncIt.advance()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.get()">SyncIt.get()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getversion()">SyncIt.getVersion()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getfirstindatasets()">SyncIt.getFirstInDatasets()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getfull()">SyncIt.getFull()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getdatasetnames()">SyncIt.getDatasetNames()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getdatakeysindataset()">SyncIt.getDatakeysInDataset()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#remove%20any%20outstanding%20uploads%20for%20a%20specific%20dataset%20%2F%20datakey.">Remove any outstanding uploads for a specific Dataset / Datakey.</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.clean()">SyncIt.clean()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>SyncIt.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">,</span> <span class="nx">addEvents</span><span class="p">,</span> <span class="nx">addLocking</span><span class="p">,</span> <span class="nx">updateResult</span><span class="p">)</span> <span class="p">{</span>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="kd">var</span> <span class="nx">LOCKING</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">ERROR</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">FollowInformationType</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>_map()</strong></p>
  </div>
  <div class="body"><p>Simple map function for when Array.map() is not available.</p>

<ul>
<li><strong>@param {Array} <code>arr</code></strong> The array to filter.</li>
<li><strong>@param {Function} <code>filterFunc</code></strong> The function to use for filtering</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">_map</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">map</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">func</span><span class="p">);</span> <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">func</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>_filter()</strong></p>
  </div>
  <div class="body"><p>Simple filter function for when Array.filter() is not available.</p>

<ul>
<li><strong>@param {Array} <code>arr</code></strong> The array to filter.</li>
<li><strong>@param {Function} <code>filterFunc</code></strong> The function to use for filtering</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">_filter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span><span class="nx">filterFunc</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">filterFunc</span><span class="p">);</span> <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">filterFunc</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>_shallowCopyKeys()</strong></p>
  </div>
  <div class="body"><p>Will make a shallow copy of <code>ob</code> containing <code>keysToCopy</code>. If <code>copyNullEtc</code>
is true it will not copy <code>null</code> or <code>undefined</code> values.</p>

<ul>
<li><strong>@param {Object} <code>ob</code></strong></li>
<li><strong>@param {Array} <code>keysToCopy</code></strong></li>
<li><strong>@param {Boolean} <code>copyNullEtc</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">_shallowCopyKeys</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">keysToCopy</span><span class="p">,</span><span class="nx">copyNullEtc</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span>
      <span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="p">(</span>
        <span class="p">(</span><span class="nx">keysToCopy</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="nx">keysToCopy</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">copyNullEtc</span> <span class="o">||</span> <span class="p">((</span><span class="nx">ob</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">ob</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ob</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit">
  <h2>
    <a href="#syncit" name="syncit" class="pilcrow">&#182;</a>
    SyncIt
  </h2>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="new%20syncit()">
  <h3>
    <a href="#new%20syncit()" name="new%20syncit()" class="pilcrow">&#182;</a>
    new SyncIt()
  </h3>
</div>


<p>Constructor</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {SyncIt_Path_AsyncLocalStorage} <code>pathstore</code></strong> The instance to use for storage.</li>
<li><strong>@param {Modifier} <code>modifier</code></strong> The UNIQUE User/Device which is using the instance of SyncIt.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">SyncIt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pathstore</span><span class="p">,</span> <span class="nx">modifier</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span> <span class="o">=</span> <span class="nx">pathstore</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_modifier</span> <span class="o">=</span> <span class="nx">modifier</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">ob</span><span class="p">));</span> <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_autoClean</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._getPathWatcher()</strong></p>
  </div>
  <div class="body"><p>This is used within SyncIt to connect information about that data stored in
SyncIt._ps (An instance of SyncIt_Path_AsyncLocalStorage) and the logical
values that are stored should all Pathitem be processed.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getPathWatcher</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>getWatcher()</strong></p>
  </div>
  <div class="body"><p>Watches as SyncIt_Path_AsyncLocalStorage follows the path of Pathitem
and collects information.</p>

<p>This will also prevent</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">getWatcher</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">inWhere</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">keyInfo</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Info stored at the root only exists once and can probably be
seen as metadata, so just connect it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">INFO</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">j</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>This is not infact the true root, but the root of the Path, if
the <code>dataset</code>/<code>datakey</code> has never been <code>SyncIt.advance()</code>'d then
there will be no root so this will not be called.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">ROOTITEM</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">val</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">keyInfo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">keyInfo</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span> <span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>getWatcher is always used for collecting information about one
path inside a <code>dataset</code>/<code>datakey</code>, however there is an
opportunity to collect information about whether other paths
exist or not. This will be an array of the non-follwed path.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">OTHER_PATHS</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">p</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>For every Pathitem that is encounted, we will use updateResult
to figure out the logical value should all the Pathitem be
applied.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">PATHITEM</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getKeyTimeDecoder</span><span class="p">().</span><span class="nx">call</span><span class="p">(</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">,</span>
            <span class="nx">key</span>
          <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">q</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="nx">updateResult</span><span class="p">(</span>
          <span class="nx">val</span><span class="p">,</span>
          <span class="nx">item</span><span class="p">,</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span>
        <span class="p">);</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">keyInfo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">keyInfo</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">o</span> <span class="o">==</span> <span class="s1">&#39;remove&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span> <span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>getReaditem</strong></p>
  </div>
  <div class="body"><p>Returns the data collected by <code>getWatcher</code>.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">getReaditem</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.setclonefunction()">
  <h3>
    <a href="#syncit.setclonefunction()" name="syncit.setclonefunction()" class="pilcrow">&#182;</a>
    SyncIt.setCloneFunction()
  </h3>
</div>

  </div>
  <div class="body"><p>Sometimes, SyncIt wants a deep copy of an Object, this function will allow 
you to change what function does that deep copying.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>

  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cloneFunction
</span>
      <span class="dox_type">Function</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setCloneFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cloneFunction</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span> <span class="o">=</span> <span class="nx">cloneFunction</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getmodifier()">
  <h3>
    <a href="#syncit.getmodifier()" name="syncit.getmodifier()" class="pilcrow">&#182;</a>
    SyncIt.getModifier()
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Modifier}</strong> The User/Device which is using the instance of SyncIt.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getModifier</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_modifier</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenforconflictresolutionaddedtopath()">
  <h3>
    <a href="#syncit.listenforconflictresolutionaddedtopath()" name="syncit.listenforconflictresolutionaddedtopath()" class="pilcrow">&#182;</a>
    SyncIt.listenForConflictResolutionAddedToPath()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is added to the <em>Queue</em> during conflict resolution.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(dataset, datakey, queueitem, newStoreRecord)</code>.
<ul><li><strong>@param {Dataset} <code>listener.dataset</code></strong> The <em>dataset</em> of the updated.</li>
<li><strong>@param {Datakey} <code>listener.datakey</code></strong> The <em>datakey</em> that was updated.</li>
<li><strong>@param {Pathitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> that was just added.</li>
<li><strong>@param {Storerecord} <code>listener.newStorerecord</code></strong> The <em>storerecord</em> which is now stored.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForConflictResolutionAddedToPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;conflict_resolution_items_added_to_queue&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenfordatachange()">
  <h3>
    <a href="#syncit.listenfordatachange()" name="syncit.listenfordatachange()" class="pilcrow">&#182;</a>
    SyncIt.listenForDataChange()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is changed, through whatever method.</p>

<p>NOTE: This callback is not in the normal form... no queueitem is specified in the callback.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(newStoreRecord, queueitem)</code>.
<ul><li><strong>@param {Storerecord} <code>listener.newStorerecord</code></strong> The <em>storerecord</em> which is now stored.</li>
<li><strong>@param {Pathitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> which caused the update. Note this may not map to the Storerecord when conflict resolution is occuring.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForDataChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;data_change&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenforaddedtopath()">
  <h3>
    <a href="#syncit.listenforaddedtopath()" name="syncit.listenforaddedtopath()" class="pilcrow">&#182;</a>
    SyncIt.listenForAddedToPath()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is added to the <em>Queue</em> under normal circumstances (ie not during conflict resolution).</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(dataset, datakey, queueitem, newStoreRecord)</code>.
<ul><li><strong>@param {Dataset} <code>listener.dataset</code></strong> The <em>dataset</em> of the updated.</li>
<li><strong>@param {Datakey} <code>listener.datakey</code></strong> The <em>datakey</em> that was updated.</li>
<li><strong>@param {Pathitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> that was just added.</li>
<li><strong>@param {Storerecord} <code>listener.newStorerecord</code></strong> The <em>storerecord</em> which is now stored.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForAddedToPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;added_to_queue&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenforadvanced()">
  <h3>
    <a href="#syncit.listenforadvanced()" name="syncit.listenforadvanced()" class="pilcrow">&#182;</a>
    SyncIt.listenForAdvanced()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is advanced to the <em>Store</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(dataset, datakey, queueitem, newStorerecord)</code>.
<ul><li><strong>@param {Dataset} <code>listener.dataset</code></strong> The <em>dataset</em> of the advanced.</li>
<li><strong>@param {Datakey} <code>listener.datakey</code></strong> The <em>datakey</em> that was advanced.</li>
<li><strong>@param {Pathitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> that was advanced.</li>
<li><strong>@param {Storerecord} <code>listener.newStorerecord</code></strong> The <em>storerecord</em> which is now stored.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForAdvanced</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;advanced&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenforfed()">
  <h3>
    <a href="#syncit.listenforfed()" name="syncit.listenforfed()" class="pilcrow">&#182;</a>
    SyncIt.listenForFed()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is fed using <a href="#syncit.feed--">SyncIt.feed()</a></p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(queueitem, newStorerecord)</code>.
<ul><li><strong>@param {String} <code>listener.dataset</code></strong> The dataset of the just fed Queueitem.</li>
<li><strong>@param {String} <code>listener.datakey</code></strong> The datakey of the just fed Queueitem.</li></ul></li>
<li><strong>@param {Queueitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> that was advanced.</li>
<li><strong>@param {Storerecord} <code>listener.newStorerecord</code></strong> The <em>storerecord</em> which is now stored.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForFed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;fed&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.set()">
  <h3>
    <a href="#syncit.set()" name="syncit.set()" class="pilcrow">&#182;</a>
    SyncIt.set()
  </h3>
</div>

  </div>
  <div class="body"><p>Will add a <em>Pathitem</em> that represents a complete overwrite of any existing data.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Update} <code>update</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Fired after the <em>Queue</em> has been updated. See <a href="#syncit._addtoqueue--">SyncIt._addToQueue()</a>** for documentation.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToQueue</span><span class="p">(</span>
    <span class="s1">&#39;set&#39;</span><span class="p">,</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="nx">update</span><span class="p">,</span>
    <span class="nx">whenAddedToQueue</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.remove()">
  <h3>
    <a href="#syncit.remove()" name="syncit.remove()" class="pilcrow">&#182;</a>
    SyncIt.remove()
  </h3>
</div>

  </div>
  <div class="body"><p>This will add a Pathitem to the Queue that represents the removal of data stored at a Dataset/Datakey.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Fired after the <em>Queue</em> has been updated. See <a href="#syncit._addtoqueue--">SyncIt._addToQueue()</a>** for documentation.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToQueue</span><span class="p">(</span>
    <span class="s1">&#39;remove&#39;</span><span class="p">,</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="p">{},</span>
    <span class="nx">whenAddedToQueue</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.update()">
  <h3>
    <a href="#syncit.update()" name="syncit.update()" class="pilcrow">&#182;</a>
    SyncIt.update()
  </h3>
</div>

  </div>
  <div class="body"><p>This can update one or more parts of the the data at a single <em>dataset</em> / <em>datakey</em> using something similar to the MongoDB update syntax.</p>


<div class="pilwrap" id="example">
  <h4>
    <a href="#example" name="example" class="pilcrow">&#182;</a>
    Example
  </h4>
</div>


<div class='highlight'><pre><code language=''>syncIt.update(
    'user',
    'jack',
    {'$set': {'eyes.color': 'blue'}},
    function(err, dataset, datakey, queueitem) {
        // The data now includes { eyes: { color: "blue" } } but the rest of
        // the data has been preserved
    }
);
</code></pre></div>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Update} <code>update</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Fired after the <em>Queue</em> has been updated. See <a href="#syncit._addtoqueue--">SyncIt._addToQueue()</a> for documentation.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToQueue</span><span class="p">(</span>
    <span class="s1">&#39;update&#39;</span><span class="p">,</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="nx">update</span><span class="p">,</span>
    <span class="nx">whenAddedToQueue</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.feed()">
  <h3>
    <a href="#syncit.feed()" name="syncit.feed()" class="pilcrow">&#182;</a>
    SyncIt.feed()
  </h3>
</div>

  </div>
  <div class="body"><p>This function is for feeding in external Queueitem from the <em>Respository</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Array} <code>feedQueueitems</code></strong> These are the items which are being fed from the <em>Server</em>.</li>
<li><strong>@param {Function} <code>resolutionFunction</code></strong> Called when conflict occurs, Signature: <code>function(dataset, datakey, storerecord, serverQueueitems, localPathitems, resolved)</code>.
<ul><li><strong>@param {Array} <code>resolutionFunction.dataset</code></strong> The <em>Dataset</em> of the conflict.</li>
<li><strong>@param {Array} <code>resolutionFunction.datakey</code></strong> The <em>Datakey</em> of the conflict.</li>
<li><strong>@param {Array} <code>resolutionFunction.storerecord</code></strong> What is in the local <em>Store</em> for that <em>Dataset</em> / <em>Datakey</em>.</li>
<li><strong>@param {Array} <code>resolutionFunction.localPathitems</code></strong> The <em>Pathitem</em> that has been added using functions such as <a href="#syncit.set--">SyncIt.set()</a> but is now conflicting with the data from the <em>Server</em>.</li>
<li><strong>@param {Array} <code>resolutionFunction.serverQueueitems</code></strong> The extra <em>Queueitem</em> that are on the Server.</li>
<li><strong>@param {Function} <code>resolutionFunction.resolved</code></strong> This should be called from inside resolutionFunction and will add <em>Pathitem</em> after the <em>Server</em> supplied <em>Queueitem</em>. Signature: <code>function(resolved, mergedLocalsToDoAfterwards)</code>
<ul><li><strong>@param {Boolean} <code>resolutionFunction.resolved.resolved</code></strong> use false to halt the feeding, true otherwise</li>
<li><strong>@param {Array} <code>resolutionFunction.resolved.mergedLocalsToDoAfterwards</code></strong> These will be added to the <em>Queue</em> <strong>after</strong> (currently) all serverPathitems have been advanced to the <em>Store</em>.</li></ul></li></ul></li>
<li><strong>@param {Function} <code>feedDone</code></strong> Callback for when done. Signature: <code>function(err, fedItemsFailed)</code>;
<ul><li><strong>@param {Errorcode} <code>feedDone.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Array} <code>feedDone.fedItemsFailed</code></strong> Array of items fed from the <em>Server</em> which could not be processed.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">feed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">feedQueueitems</span><span class="p">,</span> <span class="nx">resolutionFunction</span><span class="p">,</span> <span class="nx">feedDone</span><span class="p">)</span> <span class="p">{</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>Make a shallow copy of feedQueueitems so when we <code>shift()</code> we are not
fiddling with users data.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">feedQueue</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_shallowCopyKeys</span><span class="p">(</span>
        <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">],</span>
        <span class="kc">false</span>
      <span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">})(</span><span class="nx">feedQueueitems</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>If a conflict occurs we want to feed the resolutionFunction only items from
the same dataset / datakey that are based on a version higher than the one
currently in the Pathroot.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">prepareServerQueueItemForResolutionFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span> <span class="nx">feedQueue</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">firstQueueitem</span> <span class="o">=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    
    <span class="kd">var</span> <span class="nx">filterFunc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">storerecord</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">b</span> <span class="o">&gt;=</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span><span class="p">);</span>
    <span class="p">};</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">feedQueue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">s</span> <span class="o">!=</span> <span class="nx">firstQueueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">k</span> <span class="o">!=</span> <span class="nx">firstQueueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">)</span>
      <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_filter</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">filterFunc</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">_filter</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">filterFunc</span><span class="p">);</span>
  <span class="p">};</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Simple helper function that will unlock SyncIt and call the feedDone callback.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">unlockAndError</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">FEEDING</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
      <span class="nx">err</span><span class="p">,</span>
      <span class="nx">feedQueue</span>
    <span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>This function is called from resolutionFunction.resolved and will check
that resolutionFunction actually did resolve the conflict, if it did it
will add any resolving PathItem to the "c" (conflict) branch so they can
be applied later and remove all local Pathitem from the "a" branch as 
they conflict with the items sent from the server.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">perhapsResolved</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span><span class="nx">fedForSameDatasetAndDatakey</span><span class="p">,</span><span class="nx">resolved</span><span class="p">,</span><span class="nx">mergePathitem</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="kd">var</span> <span class="nx">sanatizeMergeItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">copyKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">],</span>
        <span class="nx">disallowedKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">],</span>
        <span class="nx">i</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">disallowedKeys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">disallowedKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Merge queue cannot include any &quot;</span> <span class="o">+</span> <span class="nx">disallowedKeys</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">copyKeys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">copyKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">[</span><span class="nx">copyKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">queueitem</span><span class="p">[</span><span class="nx">copyKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">s</span> <span class="o">!=</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">s</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Merge queue cannot use different dataset to stored record&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">k</span> <span class="o">!=</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Merge queue cannot use different datakey to stored record&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">};</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">resolved</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">NOT_RESOLVED</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mergePathitem</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">removePathitemFromPath</span><span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_autoClean</span><span class="p">,</span><span class="nx">next</span><span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>TODO: Sanitize the merge queue</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

    <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">pushPathitemsToNewPath</span><span class="p">(</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
      <span class="s1">&#39;c&#39;</span><span class="p">,</span>
      <span class="nx">_map</span><span class="p">(</span><span class="nx">mergePathitem</span><span class="p">,</span><span class="nx">sanatizeMergeItem</span><span class="p">),</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">feedQueue</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="p">{</span><span class="nx">cv</span><span class="o">:</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span> <span class="o">+</span> <span class="nx">fedForSameDatasetAndDatakey</span><span class="p">.</span><span class="nx">length</span><span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">setInfo</span><span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span><span class="nx">info</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">removePathitemFromPath</span><span class="p">(</span>
            <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
            <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
            <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_autoClean</span><span class="p">,</span>
            <span class="nx">next</span>
          <span class="p">);</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">);</span>
    
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>One by one, process the Pathitem which have been fed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">feedOne</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">feedQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">FEEDING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,[]);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">storerecord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">otherpaths</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">queue</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="p">{};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>Read the path, collecting information.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">followPath</span><span class="p">(</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
      <span class="s1">&#39;a&#39;</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">inWhere</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">INFO</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">info</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">ROOTITEM</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">storerecord</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">OTHER_PATHS</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">otherpaths</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">PATHITEM</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">queue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span>
            <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
            <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
            <span class="nx">key</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/.*\./</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="nx">item</span>
          <span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>It might be that we are trying to feed data which is 
based on an old storerecord, if we are just skip over it</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">feedQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
          <span class="k">return</span> <span class="nx">feedOne</span><span class="p">();</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>If we have items in our local queue with a basedonversion which is
lower than what we are being fed, it is likely that we have unadvanced
items which we have already uploaded.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">queue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span>
            <span class="nb">Error</span><span class="p">.</span><span class="nx">BASED_ON_IN_QUEUE_LESS_THAN_BASED_IN_BEING_FED</span><span class="p">,</span>
            <span class="nx">feedQueue</span>
          <span class="p">);</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>Continue with the Feed passing the information found from 
this._ps.followPath();Continue with the Feed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">return</span> <span class="nx">feedOneWorker</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span><span class="nx">queue</span><span class="p">,</span><span class="nx">info</span><span class="p">,</span><span class="nx">otherpaths</span><span class="p">);</span>

      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">);</span>
    
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>All data is now collected about what is in the Path so we can go ahead and
take appropriate action...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">feedOneWorker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span><span class="nx">queue</span><span class="p">,</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>If there is items in the Path then feed them into resolutionFunction</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">fedForSameDatasetAndDatakey</span> <span class="o">=</span> <span class="nx">prepareServerQueueItemForResolutionFunction</span><span class="p">(</span>
        <span class="nx">storerecord</span><span class="p">,</span>
        <span class="nx">feedQueue</span>
      <span class="p">);</span>

      <span class="k">return</span> <span class="nx">resolutionFunction</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
        <span class="k">this</span><span class="p">,</span>
        <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
        <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
        <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">storerecord</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">;</span>
          <span class="nx">storerecord</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">storerecord</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">storerecord</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">storerecord</span><span class="p">;</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)()),</span>
        <span class="nx">queue</span><span class="p">,</span>
        <span class="nx">fedForSameDatasetAndDatakey</span><span class="p">,</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">resolved</span><span class="p">,</span><span class="nx">mergePathitem</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">perhapsResolved</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span><span class="nx">fedForSameDatasetAndDatakey</span><span class="p">,</span><span class="nx">resolved</span><span class="p">,</span><span class="nx">mergePathitem</span><span class="p">,</span><span class="nx">feedOne</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>Just make sure that the Pathitem is the correct version to apply.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span> <span class="o">!=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">o</span> <span class="o">==</span> <span class="s1">&#39;remove&#39;</span><span class="p">))</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<p>Requests to remove data which is not there... this is probably seeing
a refeed of the delete of queue data which <strong>was</strong> there, but has been
deleted. In this situation just continue.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">feedQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">feedOne</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span>
        <span class="nx">ERROR</span><span class="p">.</span><span class="nx">FEED_VERSION_ERROR</span><span class="p">,</span>
        <span class="nx">feedQueue</span>
      <span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39">&#182;</a>
</div>
<p>This will basically apply the first Pathitem to the existing
Pathroot, giving the new Pathroot</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">newRoot</span> <span class="o">=</span> <span class="nx">_shallowCopyKeys</span><span class="p">(</span>
      <span class="nx">updateResult</span><span class="p">(</span>
        <span class="nx">storerecord</span><span class="p">,</span>
        <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span>
      <span class="p">),</span>
      <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
    <span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">joinCPathToA</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">baseV</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">changePath</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_autoClean</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">feedQueue</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">conflictPathWatcher</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getPathWatcher</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">conflictPathWatch</span> <span class="o">=</span> <span class="nx">conflictPathWatcher</span><span class="p">.</span><span class="nx">getWatcher</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">followPath</span><span class="p">(</span>
          <span class="nx">dataset</span><span class="p">,</span>
          <span class="nx">datakey</span><span class="p">,</span>
          <span class="s1">&#39;a&#39;</span><span class="p">,</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">storagekey</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">itemtype</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">conflictPathWatch</span><span class="p">(</span><span class="nx">storagekey</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">itemtype</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">itemtype</span> <span class="o">!==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">PATHITEM</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="kd">var</span> <span class="nx">storerecord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_makeFullReaditem</span><span class="p">(</span><span class="nx">conflictPathWatcher</span><span class="p">.</span><span class="nx">getReaditem</span><span class="p">());</span>
            <span class="kd">var</span> <span class="nx">queueitem</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span>
                <span class="nx">dataset</span><span class="p">,</span>
                <span class="nx">datakey</span><span class="p">,</span>
                <span class="nx">storagekey</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/.*\./</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="nx">item</span><span class="p">,</span>
                <span class="p">{</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">baseV</span><span class="o">++</span> <span class="p">}</span>
              <span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span>
              <span class="s1">&#39;conflict_resolution_items_added_to_queue&#39;</span><span class="p">,</span>
              <span class="nx">dataset</span><span class="p">,</span>
              <span class="nx">datakey</span><span class="p">,</span>
              <span class="nx">queueitem</span><span class="p">,</span>
              <span class="nx">storerecord</span>
            <span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;data_change&#39;</span><span class="p">,</span> <span class="nx">storerecord</span><span class="p">,</span> <span class="nx">queueitem</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">feedQueue</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">next</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>Set the new Pathroot, once this is done, emit the fact an item has
been fed and check that if we should be applying the conflict path
(c), if we should, do so. Once all this is done, go back and call
<code>feedOne()</code> to go and get the next item.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">setPathroot</span><span class="p">(</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
      <span class="s1">&#39;a&#39;</span><span class="p">,</span>
      <span class="nx">newRoot</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">dataset</span> <span class="o">=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">datakey</span> <span class="o">=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">storerecord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span>
          <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
          <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
          <span class="kc">null</span><span class="p">,</span>
          <span class="nx">newRoot</span>
        <span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span>
          <span class="s1">&#39;fed&#39;</span><span class="p">,</span>
          <span class="nx">dataset</span><span class="p">,</span>
          <span class="nx">datakey</span><span class="p">,</span>
          <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
          <span class="nx">storerecord</span>
        <span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;data_change&#39;</span><span class="p">,</span> <span class="nx">storerecord</span><span class="p">,</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="nx">feedQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">newRoot</span><span class="p">.</span><span class="nx">v</span> <span class="o">==</span> <span class="nx">info</span><span class="p">.</span><span class="nx">cv</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">joinCPathToA</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">.</span><span class="nx">v</span><span class="p">,</span><span class="nx">feedOne</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">feedOne</span><span class="p">();</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  
  <span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nx">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nx">queueitemValidationError</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<p>If locked, just exit.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
      <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">,</span>
      <span class="nx">feedQueueitems</span>
    <span class="p">);</span>
  <span class="p">}</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>Perform basic validation.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">feedQueueitems</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">queueitemValidationError</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_basicValidationForQueueitem</span><span class="p">(</span><span class="nx">feedQueueitems</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">queueitemValidationError</span> <span class="o">!=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
        <span class="nx">queueitemValidationError</span><span class="p">,</span>
        <span class="nx">feedQueueitems</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>Then lock</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">FEEDING</span><span class="p">);</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<p>Process the first item.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">feedOne</span><span class="p">();</span>
  
<span class="p">};</span>

<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_basicValidationForQueueitem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">,</span><span class="nx">skips</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span>
    <span class="nx">requiredFields</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">s</span><span class="o">:</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATASET</span><span class="p">,</span>
      <span class="nx">k</span><span class="o">:</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATAKEY</span><span class="p">,</span>
      <span class="nx">o</span><span class="o">:</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_OPERATION</span>
    <span class="p">};</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">requiredFields</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span>
      <span class="nx">requiredFields</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
      <span class="o">!</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">requiredFields</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">DATASET_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATASET</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">DATAKEY_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATAKEY</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">OPERATION_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_OPERATION</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">skips</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">skips</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">m</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">MODIFIER_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_MODIFIER</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._makeFullReaditem()</strong></p>
  </div>
  <div class="body"><p>Adds information which is not necessary to store in the Pathitems itself.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_makeFullReaditem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataFromStore</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">m</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">(),</span>
    <span class="nx">r</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">};</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">defaults</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dataFromStore</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">dataFromStore</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">defaults</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">dataFromStore</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._addToQueue()</strong></p>
  </div>
  <div class="body"><p>Adds a Pathitem to the Queue.</p>

<p><strong>Parameters</strong></p>

<ul>
<li><strong>@param {Operation} <code>operation</code></strong></li>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Update} <code>update</code></strong></li>
<li><strong>@param {Modifier} <code>modifier</code></strong></li>
<li><strong>@param {Basedonversion} <code>basedonversion</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Callback for when adding is complete. Signature: <code>function(errorCode, dataset, datakey, queueitem)</code>
<ul><li><strong>@param {Errorcode} <code>whenAddedToQueue.errorCode</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Dataset} <code>whenAddedToQueue.dataset</code></strong> The Dataset of the Pathitem.</li>
<li><strong>@param {Datakey} <code>whenAddedToQueue.datakey</code></strong> The Datakey of the Pathitem.</li>
<li><strong>@param {Pathitem} <code>whenAddedToQueue.queueitem</code></strong> The Pathitem that has just been added.</li>
<li><strong>@param {Readrecord} <code>whenAddedToQueue.readrecord</code></strong> The now logical value of the data.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_addToQueue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">operation</span><span class="p">,</span> <span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47">&#182;</a>
</div>
<p>If locked, exit.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">whenAddedToQueue</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">queueitem</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">o</span><span class="o">:</span> <span class="nx">operation</span><span class="p">,</span> 
    <span class="nx">u</span><span class="o">:</span> <span class="nx">update</span>
  <span class="p">};</span>


  <span class="kd">var</span> <span class="nx">pathWatcher</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getPathWatcher</span><span class="p">();</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">ADDING_TO_QUEUE</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="s1">&#39;a&#39;</span><span class="p">,</span>
    <span class="nx">queueitem</span><span class="p">,</span>
    <span class="kc">true</span><span class="p">,</span>
    <span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getWatcher</span><span class="p">(),</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">ref</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">ADDING_TO_QUEUE</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">whenAddedToQueue</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">pathWatchedItem</span> <span class="o">=</span> <span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getReaditem</span><span class="p">(),</span>
        <span class="nx">storerecord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_makeFullReaditem</span><span class="p">(</span><span class="nx">pathWatchedItem</span><span class="p">),</span>
        <span class="nx">emitQueueitem</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span>
          <span class="nx">dataset</span><span class="p">,</span>
          <span class="nx">datakey</span><span class="p">,</span>
          <span class="nx">ref</span><span class="p">,</span>
          <span class="nx">queueitem</span><span class="p">,</span>
          <span class="nx">pathWatchedItem</span>
        <span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span>
        <span class="s1">&#39;added_to_queue&#39;</span><span class="p">,</span>
        <span class="nx">dataset</span><span class="p">,</span>
        <span class="nx">datakey</span><span class="p">,</span>
        <span class="nx">emitQueueitem</span><span class="p">,</span>
        <span class="nx">storerecord</span>
      <span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;data_change&#39;</span><span class="p">,</span> <span class="nx">storerecord</span><span class="p">,</span> <span class="nx">emitQueueitem</span><span class="p">);</span>
      <span class="nx">whenAddedToQueue</span><span class="p">(</span>
        <span class="nx">err</span><span class="p">,</span>
        <span class="nx">dataset</span><span class="p">,</span>
        <span class="nx">datakey</span><span class="p">,</span>
        <span class="nx">queueitem</span><span class="p">,</span>
        <span class="nx">storerecord</span>
      <span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._getEmptyStorerecord()</strong></p>
  </div>
  <div class="body"><p>When advancing a <em>Pathitem</em> either because SyncIt is moving data from the <em>Queue</em> to the <em>Store</em> or just because it is processing a `<a href="#syncit.get--">SyncIt.get()</a> it is possible that no data already exists at the <em>Store</em> for that <em>Dataset</em> / <em>Datakey</em>. It's handy to use this function to get something that looks like stored data to limit code complexity.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">i</span><span class="o">:</span><span class="p">{},</span>
    <span class="nx">v</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
    <span class="nx">j</span><span class="o">:</span><span class="p">{},</span>
    <span class="nx">p</span><span class="o">:</span><span class="p">[],</span>
    <span class="nx">q</span><span class="o">:</span><span class="p">[],</span>
    <span class="nx">r</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
    <span class="nx">t</span><span class="o">:</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">()</span>
  <span class="p">};</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.advance()">
  <h3>
    <a href="#syncit.advance()" name="syncit.advance()" class="pilcrow">&#182;</a>
    SyncIt.advance()
  </h3>
</div>

  </div>
  <div class="body"><p>Applies the very first <em>Pathitem</em> in the <em>Queue</em> onto the data already in the <em>Store</em> for that <em>Dataset</em> / <em>Datakey</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>done</code></strong> Callback when the operation is complete (or not). Signature: <code>function(errorCode, queueitem, storerecord)</code>
<ul><li><strong>@param {ErrorCode} <code>done.errorCode</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Dataset} <code>done.dataset</code></strong></li>
<li><strong>@param {Datakey} <code>done.datakey</code></strong></li>
<li><strong>@param {Pathitem} <code>done.queueitem</code></strong> The <em>Pathitem</em> that was just advanced</li>
<li><strong>@param {Storerecord} <code>done.storerecord</code></strong> The new <em>Storerecord</em></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">advance</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">done</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">ADVANCING</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">addedPathkey</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">findFirstDatasetDatakey</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">ADVANCING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">newRoot</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">advance</span><span class="p">(</span>
      <span class="nx">dataset</span><span class="p">,</span> 
      <span class="nx">datakey</span><span class="p">,</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_autoClean</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">pathRoot</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">newRootCb</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pathRoot</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pathRoot</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">addedPathkey</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50">&#182;</a>
</div>
<p>Filter to just keys r, v, i and possibly t anything else can
be recreated.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">newRoot</span> <span class="o">=</span> <span class="nx">updateResult</span><span class="p">(</span><span class="nx">pathRoot</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span><span class="p">);</span>
        <span class="nx">newRoot</span> <span class="o">=</span> <span class="nx">_shallowCopyKeys</span><span class="p">(</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">addedPathkey</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">),</span>
          <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">],</span>
          <span class="kc">false</span>
        <span class="p">);</span>
        <span class="nx">newRootCb</span><span class="p">(</span><span class="nx">newRoot</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">ADVANCING</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span>
          <span class="s1">&#39;advanced&#39;</span><span class="p">,</span>
          <span class="nx">dataset</span><span class="p">,</span>
          <span class="nx">datakey</span><span class="p">,</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">addedPathkey</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">),</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">addedPathkey</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">)</span>
        <span class="p">);</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span>
          <span class="nx">err</span><span class="p">,</span>
          <span class="nx">dataset</span><span class="p">,</span>
          <span class="nx">datakey</span><span class="p">,</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">addedPathkey</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">),</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">addedPathkey</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">)</span>
        <span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._addObviousInforation</strong></p>
  </div>
  <div class="body"><p>Maybe, all the information got here is not obvious, but it can be calculated
from other information... Every Pathitem must have been created locally so
we must be the modifier, so we don't store that. The modificationtime is 
can also be retrieved from the Pathitem reference.</p>

<p><strong>@param {Dataset} <code>dataset</code></strong>
<strong>@param {Datakey} <code>datakey</code></strong>
<strong>@param {Pathref} <code>reference</code></strong>
<strong>@param {Pathitem} <code>ob</code></strong> The item to add the "obvious" information to.
**@return {Object} <code>ob</code> with the "obvious" information.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_addObviousInforation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">ob</span><span class="p">,</span><span class="nx">extra</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">_shallowCopyKeys</span><span class="p">(</span><span class="nx">ob</span><span class="p">),</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">dataset</span><span class="p">;</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">datakey</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">reference</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">reference</span> <span class="o">===</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;No time and no time found in key&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getKeyTimeDecoder</span><span class="p">())(</span><span class="nx">reference</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">extra</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">extra</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">extra</span><span class="p">.</span><span class="nx">b</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">extra</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">extra</span><span class="p">.</span><span class="nx">v</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^_/</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">delete</span> <span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.get()">
  <h3>
    <a href="#syncit.get()" name="syncit.get()" class="pilcrow">&#182;</a>
    SyncIt.get()
  </h3>
</div>

  </div>
  <div class="body"><p>Will retrieve information from SyncIt by reading what is first in the <em>Store</em> and then every <em>Pathitem</em> for the same Dataset / Datakey.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenDataRetrieved</code></strong> Signature: <code>function(err, jreadInfo)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDataRetrieved.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Object} <code>whenDataRetrieved.jreadInfo</code></strong> The requsted information.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenDataRetrieved</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getFull</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getversion()">
  <h3>
    <a href="#syncit.getversion()" name="syncit.getversion()" class="pilcrow">&#182;</a>
    SyncIt.getVersion()
  </h3>
</div>

  </div>
  <div class="body"><p>Will retrieve information about the version in the store.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenVersionFound</code></strong> Signature: <code>function(err, version)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDataRetrieved.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Number} <code>whenDataRetrieved.version</code></strong> The version of the data, 0 means no data found found, 1 is the first version.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getVersion</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenVersionFound</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getFull</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">whenVersionFound</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">([</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">whenVersionFound</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">whenVersionFound</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getfirstindatasets()">
  <h3>
    <a href="#syncit.getfirstindatasets()" name="syncit.getfirstindatasets()" class="pilcrow">&#182;</a>
    SyncIt.getFirstInDatasets()
  </h3>
</div>

  </div>
  <div class="body"><p>Gets the Pathitem which should be next uploaded to the server or will be advanced
should <code>SyncIt.advance()</code> be called.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Array|null} <code>datasets</code></strong> An array of datasets which are acceptable, or null for any</li>
<li><strong>@param {Function} <code>done</code></strong> Callback. Signature: Function(err, pathitem)
<ul><li><strong>@param {ErrorCode} <code>done.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Pathitem} <code>done.pathitem</code></strong> The Pathitem.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFirstInDatasets</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datasets</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getFirstPathitem</span><span class="p">(</span>
    <span class="nx">datasets</span><span class="p">,</span>
    <span class="s1">&#39;a&#39;</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">PATH_EMPTY</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">qi</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getRootItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">err</span> <span class="o">=</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
          <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">qi</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">v</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">qi</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">);</span>
  
<span class="p">};</span>

<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFirst</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getFirstInDatasets</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">done</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
  </div>
  <div class="body">
<div class="pilwrap" id="syncit.getfull()">
  <h3>
    <a href="#syncit.getfull()" name="syncit.getfull()" class="pilcrow">&#182;</a>
    SyncIt.getFull()
  </h3>
</div>


<p>Will get ALL information for a <em>Dataset</em> / <em>Datakey</em> from SyncIt including metadata.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenDataRetrieved</code></strong> Signature: Function(err, jreadh)
<ul><li><strong>@param {ErrorCode} <code>whenDataRetrieved.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Jread} <code>whenDataRetrieved.jread</code></strong> The requsted information.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFull</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenDataRetrieved</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">pathWatcher</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getPathWatcher</span><span class="p">();</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">followPath</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getWatcher</span><span class="p">(),</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="kd">var</span> <span class="nx">fullData</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">fullData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getReaditem</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fullData</span><span class="p">.</span><span class="nx">r</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">err</span> <span class="o">=</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">fullData</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getdatasetnames()">
  <h3>
    <a href="#syncit.getdatasetnames()" name="syncit.getdatasetnames()" class="pilcrow">&#182;</a>
    SyncIt.getDatasetNames()
  </h3>
</div>

  </div>
  <div class="body"><p>Lists all dataset names in the <em>Store</em>, <em>Queue</em> or both.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>whenDatasetsKnown</code></strong> Signature: <code>function(err, arrayOfNames)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDatasetsKnown.err</code></strong> See <code>SyncIt_Constant.Error</code>.</li>
<li><strong>@param {Array} <code>whenDatasetsKnown.arrayOfNames</code></strong> An array of <em>dataset</em> names</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDatasetNames</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">whenDatasetsKnown</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getDatasetNames</span><span class="p">(</span><span class="nx">whenDatasetsKnown</span><span class="p">);</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getdatakeysindataset()">
  <h3>
    <a href="#syncit.getdatakeysindataset()" name="syncit.getdatakeysindataset()" class="pilcrow">&#182;</a>
    SyncIt.getDatakeysInDataset()
  </h3>
</div>

  </div>
  <div class="body"><p>Lists Datakeys in a Dataset.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>datasetName</code></strong></li>
<li><strong>@param {Function} <code>whenDatakeysKnown</code></strong> Signature: <code>function(err, arrayOfNames)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDatakeysKnown.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Array} <code>whenDatakeysKnown.arrayOfNames</code></strong> An array of <em>Datakey</em> names</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datasetName</span><span class="p">,</span> <span class="nx">whenDatakeysKnown</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span><span class="p">(</span><span class="nx">datasetName</span><span class="p">,</span> <span class="nx">whenDatakeysKnown</span><span class="p">);</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="remove%20any%20outstanding%20uploads%20for%20a%20specific%20dataset%20%2F%20datakey.">
  <h3>
    <a href="#remove%20any%20outstanding%20uploads%20for%20a%20specific%20dataset%20%2F%20datakey." name="remove%20any%20outstanding%20uploads%20for%20a%20specific%20dataset%20%2F%20datakey." class="pilcrow">&#182;</a>
    Remove any outstanding uploads for a specific Dataset / Datakey.
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {ErrorCode} <code>next.err</code></strong> See SyncIt_Constant.Error.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">purge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">purge</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.clean()">
  <h3>
    <a href="#syncit.clean()" name="syncit.clean()" class="pilcrow">&#182;</a>
    SyncIt.clean()
  </h3>
</div>

  </div>
  <div class="body"><p>Will remove the remnants of conflict resolution, these <strong>should</strong> only be
<code>cv</code> Info in Root of a Dataset/Datakey but should there be any 
disconnected Pathitem from unsafe shutdowns it will remove those too. Note
that these disconnected Pathitem or old <code>cv</code> records in the Info of the
Dataset / Datakey Root's do not cause ill effects, except for the tiny
amounts of space.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>done</code></strong> Signature: <code>function(err)</code></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clean</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">done</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
  
  <span class="kd">var</span> <span class="nx">cleanDatakey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">pathWatcher</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getPathWatcher</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">followPath</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getWatcher</span><span class="p">(),</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getReaditem</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">removeConflictInfo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">info</span><span class="p">.</span><span class="nx">j</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">delete</span> <span class="nx">info</span><span class="p">.</span><span class="nx">j</span><span class="p">.</span><span class="nx">cv</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">setInfo</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">info</span><span class="p">.</span><span class="nx">j</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">removeCPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">removePath</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="nx">removeConflictInfo</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;How did we end up with more than two paths?&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;How did we end up with paths other than &#39;c&#39; and &#39;a&#39;?&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">removeCPath</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">removeConflictInfo</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">cleanDataset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">datakeys</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">todo</span> <span class="o">=</span> <span class="nx">datakeys</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">terminated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">cleanDatakeyCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">terminated</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">terminated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">((</span><span class="o">--</span><span class="nx">todo</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">terminated</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">todo</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cleanDatakey</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakeys</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">cleanDatakeyCallback</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getDatasetNames</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">datasets</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">terminated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">todo</span> <span class="o">=</span> <span class="nx">datasets</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">cleanDatasetCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">terminated</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">terminated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="o">--</span><span class="nx">todo</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">terminated</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">clean</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
          <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span> 
      <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> 
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">todo</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cleanDataset</span><span class="p">(</span><span class="nx">datasets</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">cleanDatasetCallback</span><span class="p">);</span>
    <span class="p">}</span>
    
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="p">};</span>

<span class="nx">addEvents</span><span class="p">(</span><span class="nx">SyncIt</span><span class="p">,[</span><span class="s1">&#39;fed&#39;</span><span class="p">,</span><span class="s1">&#39;advanced&#39;</span><span class="p">,</span><span class="s1">&#39;added_to_queue&#39;</span><span class="p">,</span><span class="s1">&#39;conflict_resolution_items_added_to_queue&#39;</span><span class="p">,</span><span class="s1">&#39;data_change&#39;</span><span class="p">]);</span>
<span class="nx">addLocking</span><span class="p">(</span><span class="nx">SyncIt</span><span class="p">,</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">SyncIt</span><span class="p">;</span>

<span class="p">}(</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./Constant.js&#39;</span><span class="p">),</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;add-events&#39;</span><span class="p">),</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./addLocking.js&#39;</span><span class="p">),</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./updateResult.js&#39;</span><span class="p">)</span>
<span class="p">));</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
