<!DOCTYPE html>
<html>
<head>
  <title>browser-lib.umd.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "browser-lib.umd.js", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#asynclocalstorage">AsyncLocalStorage</a>
      </div>
      <div class="heading h2">
        <a href="#new%20syncit_path_asynclocalstorage()">new SyncIt_Path_AsyncLocalStorage()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.getkeytimedecoder()">SyncIt_Path_AsyncLocalStorage.getKeyTimeDecoder()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.getrootitem()">SyncIt_Path_AsyncLocalStorage.getRootItem()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.getinfo()">SyncIt_Path_AsyncLocalStorage.getInfo()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.setinfo()">SyncIt_Path_AsyncLocalStorage.setInfo()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.setpathroot()">SyncIt_Path_AsyncLocalStorage.setPathroot()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.advance()">SyncIt_Path_AsyncLocalStorage.advance()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.removepathitemfrompath()">SyncIt_Path_AsyncLocalStorage.removePathitemFromPath()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.changepath()">SyncIt_Path_AsyncLocalStorage.changePath()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.removepath()">SyncIt_Path_AsyncLocalStorage.removePath()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._removepathitems()">SyncIt_Path_AsyncLocalStorage._removePathItems()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._removepathitem()">SyncIt_Path_AsyncLocalStorage._removePathItem()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._setroot()">SyncIt_Path_AsyncLocalStorage._setRoot()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._setpathitem()">SyncIt_Path_AsyncLocalStorage._setPathItem()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.__setitem()">SyncIt_Path_AsyncLocalStorage.__setItem()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.__removeitem()">SyncIt_Path_AsyncLocalStorage.__removeItem()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._getpathitem()">SyncIt_Path_AsyncLocalStorage._getPathItem()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._getroot()">SyncIt_Path_AsyncLocalStorage._getRoot()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.__getitem()">SyncIt_Path_AsyncLocalStorage.__getItem()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._removeprivatepathstoragedata()">SyncIt_Path_AsyncLocalStorage._removePrivatePathStorageData()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._firefollowinformationtypeforroot()">SyncIt_Path_AsyncLocalStorage._fireFollowInformationTypeForRoot()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._calculatelink()">SyncIt_Path_AsyncLocalStorage._calculateLink()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.followpath()">SyncIt_Path_AsyncLocalStorage.followPath()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._createanonymouspath()">SyncIt_Path_AsyncLocalStorage._createAnonymousPath()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.pushpathitemstonewpath()">SyncIt_Path_AsyncLocalStorage.pushPathitemsToNewPath()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.push()">SyncIt_Path_AsyncLocalStorage.push()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.getdatasetnames()">SyncIt_Path_AsyncLocalStorage.getDatasetNames()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.getdatakeysindataset()">SyncIt_Path_AsyncLocalStorage.getDatakeysInDataset()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.findfirstdatasetdatakey()">SyncIt_Path_AsyncLocalStorage.findFirstDatasetDatakey()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.getfirstpathitemindatasets()">SyncIt_Path_AsyncLocalStorage.getFirstPathitemInDatasets()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage._findfirstdatasetdatakeyreference()">SyncIt_Path_AsyncLocalStorage._findFirstDatasetDatakeyReference()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit_path_asynclocalstorage.clean()">SyncIt_Path_AsyncLocalStorage.clean()</a>
      </div>
      <div class="heading h2">
        <a href="#syncit">SyncIt</a>
      </div>
      <div class="heading h3">
        <a href="#new%20syncit()">new SyncIt()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.setclonefunction()">SyncIt.setCloneFunction()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getmodifier()">SyncIt.getModifier()</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenforaddedtopath()">SyncIt.listenForAddedToPath()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenforadvanced()">SyncIt.listenForAdvanced()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenforfed()">SyncIt.listenForFed()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.set()">SyncIt.set()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.remove()">SyncIt.remove()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.update()">SyncIt.update()</a>
      </div>
      <div class="heading h4">
        <a href="#example">Example</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.feed()">SyncIt.feed()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.advance()">SyncIt.advance()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.get()">SyncIt.get()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getversion()">SyncIt.getVersion()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getfirstindatasets()">SyncIt.getFirstInDatasets()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getfull()">SyncIt.getFull()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getdatasetnames()">SyncIt.getDatasetNames()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getdatakeysindataset()">SyncIt.getDatakeysInDataset()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#remove%20any%20outstanding%20uploads%20for%20a%20specific%20dataset%20%2F%20datakey.">Remove any outstanding uploads for a specific Dataset / Datakey.</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.clean()">SyncIt.clean()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h2">
        <a href="#syncitbuffer">SyncItBuffer</a>
      </div>
      <div class="heading h1">
        <a href="#synclocalstorage">SyncLocalStorage</a>
      </div>
      <div class="heading h2">
        <a href="#new%20synclocalstorage()">new SyncLocalStorage()</a>
      </div>
      <div class="heading h3">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h2">
        <a href="#synclocalstorage.prototype.setitem()">SyncLocalStorage.prototype.setItem()</a>
      </div>
      <div class="heading h3">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h2">
        <a href="#synclocalstorage.prototype.clear()">SyncLocalStorage.prototype.clear()</a>
      </div>
      <div class="heading h2">
        <a href="#synclocalstorage.prototype.key()">SyncLocalStorage.prototype.key()</a>
      </div>
      <div class="heading h3">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h2">
        <a href="#synclocalstorage.prototype.getitem()">SyncLocalStorage.prototype.getItem()</a>
      </div>
      <div class="heading h3">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h2">
        <a href="#synclocalstorage.prototype.removeitem()">SyncLocalStorage.prototype.removeItem()</a>
      </div>
      <div class="heading h3">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h2">
        <a href="#synclocalstorage.prototype.findkeys()">SyncLocalStorage.prototype.findKeys()</a>
      </div>
      <div class="heading h3">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h1">
        <a href="#addlocking()">addLocking()</a>
      </div>
      <div class="heading h2">
        <a href="#example">Example</a>
      </div>
      <div class="heading h2">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#class._amilocked()">CLASS._amILocked()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#class._lockfor()">CLASS._lockFor()</a>
      </div>
      <div class="heading h3">
        <a href="#class._unlockfor()">CLASS._unlockFor()</a>
      </div>
      <div class="heading h3">
        <a href="#classfunc.islocked()">classFunc.isLocked()</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h1">
        <a href="#dontlistlocallydeleteddatakeys()">dontListLocallyDeletedDatakeys()</a>
      </div>
      <div class="heading h1">
        <a href="#makeasync(classfunc%2C%20asynchronousdelay)">makeAsync(classFunc, asynchronousDelay)</a>
      </div>
      <div class="heading h2">
        <a href="#example">Example</a>
      </div>
      <div class="heading h2">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h1">
        <a href="#addevents()">addEvents()</a>
      </div>
      <div class="heading h2">
        <a href="#example">Example</a>
      </div>
      <div class="heading h2">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#class.on()">CLASS.on()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#class.once()">CLASS.once()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#class.removealllisteners()">CLASS.removeAllListeners()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#class.removealloncelisteners()">CLASS.removeAllOnceListeners()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#class.removelistener()">CLASS.removeListener()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#class.removeoncelistener()">CLASS.removeOnceListener()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h1">
        <a href="#gettlidencoderdecoder()">getTLIdEncoderDecoder()</a>
      </div>
      <div class="heading h2">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h2">
        <a href="#example">Example</a>
      </div>
      <div class="heading h3">
        <a href="#manip()">manip()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#manip._setkey()">manip._setKey()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#manip._getkey()">manip._getKey()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#manip._remkey()">manip._remKey()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#manip.addmanipulation()">manip.addManipulation()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#updateresult()">updateResult()</a>
      </div>
      <div class="heading h3">
        <a href="#updateresult.op_update()">updateResult.op_update()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#updateresult.op_removedata()">updateResult.op_removeData()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#updateresult.op_set()">updateResult.op_set()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>browser-lib.umd.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="o">!</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="o">==</span><span class="k">typeof</span> <span class="nx">exports</span><span class="o">&amp;&amp;</span><span class="s2">&quot;undefined&quot;</span><span class="o">!=</span><span class="k">typeof</span> <span class="nx">module</span><span class="p">)</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="nx">e</span><span class="p">();</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="s2">&quot;function&quot;</span><span class="o">==</span><span class="k">typeof</span> <span class="nx">define</span><span class="o">&amp;&amp;</span><span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span><span class="nx">define</span><span class="p">([],</span><span class="nx">e</span><span class="p">);</span><span class="k">else</span><span class="p">{</span><span class="kd">var</span> <span class="nx">f</span><span class="p">;</span><span class="s2">&quot;undefined&quot;</span><span class="o">!=</span><span class="k">typeof</span> <span class="nb">window</span><span class="o">?</span><span class="nx">f</span><span class="o">=</span><span class="nb">window</span><span class="o">:</span><span class="s2">&quot;undefined&quot;</span><span class="o">!=</span><span class="k">typeof</span> <span class="nx">global</span><span class="o">?</span><span class="nx">f</span><span class="o">=</span><span class="nx">global</span><span class="o">:</span><span class="s2">&quot;undefined&quot;</span><span class="o">!=</span><span class="k">typeof</span> <span class="nx">self</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">f</span><span class="o">=</span><span class="nx">self</span><span class="p">),</span><span class="nx">f</span><span class="p">.</span><span class="nx">SyncItLib</span><span class="o">=</span><span class="nx">e</span><span class="p">()}}(</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">define</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">;</span><span class="k">return</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">e</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">function</span> <span class="nx">s</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="nx">u</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">n</span><span class="p">[</span><span class="nx">o</span><span class="p">]){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">[</span><span class="nx">o</span><span class="p">]){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="k">typeof</span> <span class="nx">require</span><span class="o">==</span><span class="s2">&quot;function&quot;</span><span class="o">&amp;&amp;</span><span class="nx">require</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">u</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">)</span><span class="k">return</span> <span class="nx">a</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="o">!</span><span class="mi">0</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="k">return</span> <span class="nx">i</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="o">!</span><span class="mi">0</span><span class="p">);</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Cannot find module &#39;&quot;</span><span class="o">+</span><span class="nx">o</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)}</span><span class="kd">var</span> <span class="nx">f</span><span class="o">=</span><span class="nx">n</span><span class="p">[</span><span class="nx">o</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="nx">exports</span><span class="o">:</span><span class="p">{}};</span><span class="nx">t</span><span class="p">[</span><span class="nx">o</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">o</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="nx">e</span><span class="p">];</span><span class="k">return</span> <span class="nx">s</span><span class="p">(</span><span class="nx">n</span><span class="o">?</span><span class="nx">n</span><span class="o">:</span><span class="nx">e</span><span class="p">)},</span><span class="nx">f</span><span class="p">,</span><span class="nx">f</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">r</span><span class="p">)}</span><span class="k">return</span> <span class="nx">n</span><span class="p">[</span><span class="nx">o</span><span class="p">].</span><span class="nx">exports</span><span class="p">}</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="k">typeof</span> <span class="nx">require</span><span class="o">==</span><span class="s2">&quot;function&quot;</span><span class="o">&amp;&amp;</span><span class="nx">require</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">o</span><span class="o">&lt;</span><span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">o</span><span class="o">++</span><span class="p">)</span><span class="nx">s</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">o</span><span class="p">]);</span><span class="k">return</span> <span class="nx">s</span><span class="p">})({</span><span class="mi">1</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">SyncLocalStorage</span><span class="p">,</span><span class="nx">makeAsync</span><span class="p">)</span> <span class="p">{</span>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="asynclocalstorage">
  <h1>
    <a href="#asynclocalstorage" name="asynclocalstorage" class="pilcrow">&#182;</a>
    AsyncLocalStorage
  </h1>
</div>

  </div>
  <div class="body"><p>An Asynchronous version of SyncLocalStorage, this is the base storage driver
for SyncIt.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">return</span>  <span class="nx">makeAsync</span><span class="p">(</span><span class="nx">SyncLocalStorage</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="p">}(</span><span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./SyncLocalStorage&#39;</span><span class="p">),</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./makeAsync.js&#39;</span><span class="p">)));</span>

<span class="p">},{</span><span class="s2">&quot;./SyncLocalStorage&quot;</span><span class="o">:</span><span class="mi">7</span><span class="p">,</span><span class="s2">&quot;./makeAsync.js&quot;</span><span class="o">:</span><span class="mi">11</span><span class="p">}],</span><span class="mi">2</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: 2013 Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="kd">var</span> <span class="nb">Error</span> <span class="o">=</span> <span class="p">{};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Everything was normal.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>A request was made for data at a location, but that location contains no data.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Data wrote from journal into store, but we could not clear the journal record.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">NOTHING_TO_ADVANCE_TO</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
<span class="nb">Error</span><span class="p">.</span><span class="nx">PATH_DOES_NOT_EXISTS</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
<span class="nb">Error</span><span class="p">.</span><span class="nx">MULTIPLE_PATHS_FOUND</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>The data is currently locked, please try again.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="nb">Error</span><span class="p">.</span><span class="nx">FEED_VERSION_ERROR</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Trying to change data post delete</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>If you have local Queueitem that have been put into the Repository and not
applied locally, but are feeding Queueitem with a higher version.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">BASED_ON_IN_QUEUE_LESS_THAN_BASED_IN_BEING_FED</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Validation Error</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATASET</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Validation Error</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATAKEY</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Validation Error</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_MODIFIER</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Validation Error</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_OPERATION</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>A request was made to add a Queueitem, but it is based on an outdated version. - server only</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_ADD_QUEUEITEM_BASED_ON_OLD_VERSION</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>For some reason, we are trying to add an item based on something that does not yet exist! - server only</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_ADD_FUTURE_QUEUEITEM</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>A request was made to add a Queueitem, but we already have it (note this may only happen for the latest!) - server only</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_ADD_ALREADY_ADDED_QUEUEITEM</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Trying to apply an update, but the queue is empty.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">PATH_EMPTY</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>When resolving conflict, we were told not to continue</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">Error</span><span class="p">.</span><span class="nx">NOT_RESOLVED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">Location</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">Location</span><span class="p">.</span><span class="nx">IN_QUEUE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="nx">Location</span><span class="p">.</span><span class="nx">IN_STORE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">Locking</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">Locking</span><span class="p">.</span><span class="nx">ADDING_TO_QUEUE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="nx">Locking</span><span class="p">.</span><span class="nx">ADVANCING</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="nx">Locking</span><span class="p">.</span><span class="nx">FEEDING</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="nx">Locking</span><span class="p">.</span><span class="nx">CLEANING</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

<span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">Validation</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">Validation</span><span class="p">.</span><span class="nx">DATASET_REGEXP</span> <span class="o">=</span> <span class="sr">/^[A-Za-z][A-Za-z0-9\-]+$/</span><span class="p">;</span>

<span class="nx">Validation</span><span class="p">.</span><span class="nx">DATAKEY_REGEXP</span> <span class="o">=</span> <span class="sr">/^[A-Za-z][A-Za-z0-9\-]+$/</span><span class="p">;</span>

<span class="nx">Validation</span><span class="p">.</span><span class="nx">MODIFIER_REGEXP</span> <span class="o">=</span> <span class="sr">/^[A-Za-z][A-Za-z0-9\-]+$/</span><span class="p">;</span>

<span class="nx">Validation</span><span class="p">.</span><span class="nx">OPERATION_REGEXP</span> <span class="o">=</span> <span class="sr">/^(set)|(update)|(remove)$/</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>These identify different types of information found while navigating a path.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">FollowInformationType</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">FollowInformationType</span><span class="p">.</span><span class="nx">INFO</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">FollowInformationType</span><span class="p">.</span><span class="nx">ROOTITEM</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nx">FollowInformationType</span><span class="p">.</span><span class="nx">PATHITEM</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nx">FollowInformationType</span><span class="p">.</span><span class="nx">OTHER_PATHS</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="k">return</span> <span class="p">{</span>
  <span class="nb">Error</span><span class="o">:</span> <span class="nb">Error</span><span class="p">,</span>
  <span class="nx">Location</span><span class="o">:</span> <span class="nx">Location</span><span class="p">,</span>
  <span class="nx">Locking</span><span class="o">:</span> <span class="nx">Locking</span><span class="p">,</span>
  <span class="nx">Validation</span><span class="o">:</span> <span class="nx">Validation</span><span class="p">,</span>
  <span class="nx">FollowInformationType</span><span class="o">:</span> <span class="nx">FollowInformationType</span>
<span class="p">};</span>

<span class="p">}());</span>

<span class="p">},{}],</span><span class="mi">3</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>LocalStorage Mock</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="kd">var</span> <span class="nx">FakeLocalStorage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">};</span>

<span class="nx">FakeLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_regen</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">FakeLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_regen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">keys</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">FakeLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clear</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_regen</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">FakeLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">FakeLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
<span class="p">};</span>

<span class="nx">FakeLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_regen</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">return</span> <span class="nx">FakeLocalStorage</span><span class="p">;</span>

<span class="p">}());</span>

<span class="p">},{}],</span><span class="mi">4</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">,</span><span class="nx">addEvents</span><span class="p">)</span> <span class="p">{</span>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="kd">var</span> <span class="nx">ERROR</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">FollowInformationType</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="new%20syncit_path_asynclocalstorage()">
  <h2>
    <a href="#new%20syncit_path_asynclocalstorage()" name="new%20syncit_path_asynclocalstorage()" class="pilcrow">&#182;</a>
    new SyncIt_Path_AsyncLocalStorage()
  </h2>
</div>

  </div>
  <div class="body"><p>Constructor.</p>

<ul>
<li><strong>@param {AsyncLocalStorage} <code>asyncLocalStorage</code></strong></li>
<li><strong>@param {TLEncoderDecoder} <code>tLEncoderDecoder</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">Als</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">asyncLocalStorage</span><span class="p">,</span><span class="nx">tLEncoderDecoder</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span> <span class="o">=</span> <span class="nx">asyncLocalStorage</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_ed</span> <span class="o">=</span> <span class="nx">tLEncoderDecoder</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.getkeytimedecoder()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.getkeytimedecoder()" name="syncit_path_asynclocalstorage.getkeytimedecoder()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.getKeyTimeDecoder()
  </h2>
</div>

  </div>
  <div class="body"><p>The instance has an internal Function that is used to generate a portion
of the keys based on the current time. This is Function externally 
accessible so that that key can be converted back into a timestamp.</p>

<p>TODO: I don't think that this should be here really, look at removing it...</p>

<ul>
<li><strong>@return {Function}</strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getKeyTimeDecoder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ed</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/.*\./</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.getrootitem()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.getrootitem()" name="syncit_path_asynclocalstorage.getrootitem()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.getRootItem()
  </h2>
</div>

  </div>
  <div class="body"><p>Gets a Pathroot stored at a specific Dataset / Datakey / Path.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err, rootitem)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li>
<li><strong>@param {Pathroot} <code>rootitem</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getRootItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">path</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_s&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_removePrivatePathStorageData</span><span class="p">(</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">]));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.getinfo()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.getinfo()" name="syncit_path_asynclocalstorage.getinfo()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.getInfo()
  </h2>
</div>

  </div>
  <div class="body"><p>The Root can store information, this will function retrieve that information.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li>
<li><strong>@param {Object} <code>info</code></strong> The information stored within the Root.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getInfo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">err</span> <span class="o">=</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
      <span class="nx">root</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_i&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">,{});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">.</span><span class="nx">_i</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.setinfo()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.setinfo()" name="syncit_path_asynclocalstorage.setinfo()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.setInfo()
  </h2>
</div>

  </div>
  <div class="body"><p>The Root can store information, this will function set that information.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Object} <code>info</code></strong> The Information to put in the Root</li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setInfo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">info</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">empty</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">err</span> <span class="o">=</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
      <span class="nx">root</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">_i</span> <span class="o">=</span> <span class="nx">info</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">empty</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">empty</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">delete</span> <span class="nx">root</span><span class="p">.</span><span class="nx">_i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="nx">next</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.setpathroot()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.setpathroot()" name="syncit_path_asynclocalstorage.setpathroot()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.setPathroot()
  </h2>
</div>

  </div>
  <div class="body"><p>Will set a Pathroot.</p>

<p>Note. This is a low level function and it the Pathitem linked to it will be
lost.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Object} <code>data</code></strong> What to put into the Pathroot</li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setPathroot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">data</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">err</span> <span class="o">=</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
      <span class="nx">root</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
    <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_s</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="nx">next</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.advance()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.advance()" name="syncit_path_asynclocalstorage.advance()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.advance()
  </h2>
</div>

  </div>
  <div class="body"><p>Will advance the Path (which is like a queue) for a specific Dataset / Datakey.</p>

<p>This function will call <code>calcNewRootOfPath</code> with the Pathroot and first
Pathitem within that Dataset / Datakey which itself should should call it's
own callback with the result of applying the first Pathitem onto the
Pathroot. Once this callback has been called the Pathroot will be 
set to that result.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Boolean} <code>removeOld</code></strong> If this is True the old Pathitem will be
removed, however this will be <strong>after</strong> <code>next()</code> is called.</li>
<li><strong>@param {Function} <code>calcNewRootOfPath</code></strong> This callback will be fired so
that the new Pathroot can be calculated.</li>
<li><strong>@param {Pathroot} <code>calcNewRootOfPath.pathroot</code></strong> The current Pathroot</li>
<li><strong>@param {String} <code>calcNewRootOfPath.nameOfPath</code></strong> The name of the Path
that is being advanced.</li>
<li><strong>@param {Pathitem} <code>calcNewRootOfPath.firstPathitem</code></strong> The first
PathItem in the Path.</li>
<li><strong>@param {Function} <code>calcNewRootOfPath.newRootCalculated</code></strong>
calcNewRootOfPath should call this function when the new Pathroot has been
calculated. Signature: Function(newPathroot)</li>
<li><strong>@param {Function} <code>calcNewRootOfPath.newRootCalculated.newPathroot</code></strong> The
value that the new Pathroot will</li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">advance</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">removeOld</span><span class="p">,</span><span class="nx">calcNewRootOfPath</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">k</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[a-z]$/</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">MULTIPLE_PATHS_FOUND</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">path</span> <span class="o">=</span> <span class="nx">k</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">NOTHING_TO_ADVANCE_TO</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_getPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">calcNewRootOfPath</span><span class="p">(</span>
        <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_s&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">_removePrivatePathStorageData</span><span class="p">(</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">])</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">,</span>
        <span class="nx">item</span><span class="p">,</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">newRoot</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">newRoot</span><span class="p">.</span><span class="nx">_s</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">newRoot</span><span class="p">.</span><span class="nx">_n</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">_n</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="kd">var</span> <span class="nx">toDelete</span> <span class="o">=</span> <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">;</span>
          <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newRoot</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_setRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;advance&#39;</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">);</span>
            <span class="nx">next</span><span class="p">(</span>
              <span class="nx">err</span><span class="p">,</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">_removePrivatePathStorageData</span><span class="p">(</span><span class="nx">item</span><span class="p">),</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">_removePrivatePathStorageData</span><span class="p">(</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">])</span>
            <span class="p">);</span>
            <span class="k">if</span> <span class="p">((</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">removeOld</span><span class="p">))</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">_removePathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">toDelete</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
            <span class="p">}</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
      <span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.removepathitemfrompath()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.removepathitemfrompath()" name="syncit_path_asynclocalstorage.removepathitemfrompath()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.removePathitemFromPath()
  </h2>
</div>

  </div>
  <div class="body"><p>Will remove all Pathitem in a specific Path for a Dataset / Datakey.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Boolean} <code>removeOld</code></strong> If this is True the old Pathitem will be
removed, however this will be <strong>after</strong> <code>next()</code> is called.</li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removePathitemFromPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">removeOld</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">path</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">PATH_DOES_NOT_EXISTS</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">toRemove</span> <span class="o">=</span> <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">;</span>
    <span class="k">delete</span> <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;change-root&#39;</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">);</span>
      <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">removeOld</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_removePathItems</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">toRemove</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.changepath()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.changepath()" name="syncit_path_asynclocalstorage.changepath()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.changePath()
  </h2>
</div>

  </div>
  <div class="body"><p>Will move all Pathitem from <code>fromPath</code> to <code>toPath</code>, unhooking and 
potentially removing all existing data in <code>toPath</code></p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {String} <code>fromPath</code></strong> Items will be moved from this Path</li>
<li><strong>@param {String} <code>toPath</code></strong> Items will be moved into this Path, unhooking
and perhaps deleting (see <code>removeOld</code>) items already existing there.</li>
<li><strong>@param {Boolean} <code>removeOld</code></strong> If this is True the old Pathitem will be
removed, however this will be <strong>after</strong> <code>next()</code> is called.</li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">changePath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">fromPath</span><span class="p">,</span><span class="nx">toPath</span><span class="p">,</span><span class="nx">removeOld</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">toRemove</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">fromPath</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">PATH_DOES_NOT_EXISTS</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">[</span><span class="nx">fromPath</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">PATH_DOES_NOT_EXISTS</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span>
      <span class="nx">removeOld</span> <span class="o">&amp;&amp;</span>
      <span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">toPath</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
      <span class="nx">root</span><span class="p">[</span><span class="nx">toPath</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="nx">toRemove</span> <span class="o">=</span> <span class="nx">root</span><span class="p">[</span><span class="nx">toPath</span><span class="p">].</span><span class="nx">_n</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">root</span><span class="p">[</span><span class="nx">toPath</span><span class="p">].</span><span class="nx">_n</span> <span class="o">=</span> <span class="nx">root</span><span class="p">[</span><span class="nx">fromPath</span><span class="p">].</span><span class="nx">_n</span><span class="p">;</span>
    <span class="k">delete</span> <span class="nx">root</span><span class="p">[</span><span class="nx">fromPath</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;change-path&#39;</span><span class="p">,</span><span class="nx">fromPath</span><span class="p">,</span><span class="nx">toPath</span><span class="p">);</span>
      <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">toRemove</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_removePathItems</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">toRemove</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.removepath()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.removepath()" name="syncit_path_asynclocalstorage.removepath()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.removePath()
  </h2>
</div>

  </div>
  <div class="body"><p>Removes all Pathitem and the Pathroot within a specific Dataset / Datakey /
Path.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Boolean} <code>removeOld</code></strong> If this is True the old Pathitem will be
removed, however this will be <strong>after</strong> <code>next()</code> is called.</li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removePath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">removeOld</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">toRemove</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">path</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">PATH_DOES_NOT_EXISTS</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">PATH_DOES_NOT_EXISTS</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">toRemove</span> <span class="o">=</span> <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">;</span>
    <span class="k">delete</span> <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;set-root&#39;</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">);</span>
      <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">removeOld</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_removePathItems</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">toRemove</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._removepathitems()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._removepathitems()" name="syncit_path_asynclocalstorage._removepathitems()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._removePathItems()
  </h2>
</div>

  </div>
  <div class="body"><p>Attempts to remove a Pathitem at a specific Dataset / Datakey / Reference
and then recursively remove all it's child Pathitem.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Reference} <code>ref</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_removePathItems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">ref</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">removeAndTry</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ref</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_getPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">ref</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">nextRef</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">nextRef</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">_n</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_removePathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">ref</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">nextRef</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">removeAndTry</span><span class="p">(</span><span class="nx">nextRef</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="nx">removeAndTry</span><span class="p">(</span><span class="nx">ref</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._removepathitem()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._removepathitem()" name="syncit_path_asynclocalstorage._removepathitem()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._removePathItem()
  </h2>
</div>

  </div>
  <div class="body"><p>Removes a Pathitem at a specific Dataset / Datakey / Reference.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Reference} <code>reference</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_removePathItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="p">[</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">__removeItem</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="nx">next</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">validateDatesetOrDatakey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">str</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._setroot()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._setroot()" name="syncit_path_asynclocalstorage._setroot()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._setRoot()
  </h2>
</div>

  </div>
  <div class="body"><p>Sets a Root at a Dataset / Datakey.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Object} <code>value</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setRoot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">value</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">validateDatesetOrDatakey</span><span class="p">(</span><span class="nx">dataset</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">INVALID_DATASET</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">validateDatesetOrDatakey</span><span class="p">(</span><span class="nx">datakey</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">INVALID_DATAKEY</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">__setItem</span><span class="p">([</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span><span class="nx">value</span><span class="p">,</span><span class="nx">next</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._setpathitem()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._setpathitem()" name="syncit_path_asynclocalstorage._setpathitem()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._setPathItem()
  </h2>
</div>

  </div>
  <div class="body"><p>Sets a Pathitem at a specific Dataset / Datakey / Reference.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Reference} <code>reference</code></strong></li>
<li><strong>@param {Object} <code>value</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setPathItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">value</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">validateDatesetOrDatakey</span><span class="p">(</span><span class="nx">dataset</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">INVALID_DATASET</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">validateDatesetOrDatakey</span><span class="p">(</span><span class="nx">datakey</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">INVALID_DATAKEY</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">__setItem</span><span class="p">([</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span><span class="nx">value</span><span class="p">,</span><span class="nx">next</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.__setitem()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.__setitem()" name="syncit_path_asynclocalstorage.__setitem()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.__setItem()
  </h2>
</div>

  </div>
  <div class="body"><p>Low level function for setting data at a key within the underlying storage.</p>

<ul>
<li><strong>@param {String} <code>storageKey</code></strong></li>
<li><strong>@param {Object} <code>value</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__setItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storageKey</span><span class="p">,</span><span class="nx">value</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">storageKey</span><span class="p">,</span><span class="nx">value</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;set-item&#39;</span><span class="p">,</span><span class="nx">storageKey</span><span class="p">,</span><span class="nx">value</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.__removeitem()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.__removeitem()" name="syncit_path_asynclocalstorage.__removeitem()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.__removeItem()
  </h2>
</div>

  </div>
  <div class="body"><p>Low level function for removing data at a key within the underlying storage.</p>

<ul>
<li><strong>@param {String} <code>storageKey</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__removeItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storageKey</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">storageKey</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;remove-item&#39;</span><span class="p">,</span><span class="nx">storageKey</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._getpathitem()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._getpathitem()" name="syncit_path_asynclocalstorage._getpathitem()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._getPathItem()
  </h2>
</div>

  </div>
  <div class="body"><p>Gets a Pathitem.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Reference} <code>reference</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getPathItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">__getItem</span><span class="p">([</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span><span class="nx">next</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._getroot()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._getroot()" name="syncit_path_asynclocalstorage._getroot()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._getRoot()
  </h2>
</div>

  </div>
  <div class="body"><p>Gets a Root at a Dataset / Datakey.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getRoot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">__getItem</span><span class="p">([</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span><span class="nx">next</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.__getitem()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.__getitem()" name="syncit_path_asynclocalstorage.__getitem()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.__getItem()
  </h2>
</div>

  </div>
  <div class="body"><p>Low level function for getting data at a key within the underlying storage.</p>

<ul>
<li><strong>@param {String} <code>storageKey</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__getItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storageKey</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">storageKey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">item</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._removeprivatepathstoragedata()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._removeprivatepathstoragedata()" name="syncit_path_asynclocalstorage._removeprivatepathstoragedata()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._removePrivatePathStorageData()
  </h2>
</div>

  </div>
  <div class="body"><p>SyncIt_Path_AsyncLocalStorage will store data for it's own purposes within
the Root or Pathitem which will start with an "_", this function will filter
that information out and is used to help make sure that data is presented
correctly to the outside world.</p>

<ul>
<li><strong>@param {Object} <code>ob</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_removePrivatePathStorageData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">k</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^_/</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ob</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._firefollowinformationtypeforroot()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._firefollowinformationtypeforroot()" name="syncit_path_asynclocalstorage._firefollowinformationtypeforroot()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._fireFollowInformationTypeForRoot()
  </h2>
</div>

  </div>
  <div class="body"><p>Both <code>SyncIt_Path_AsyncLocalStorage.push()</code> and 
<code>SyncIt_Path_AsyncLocalStorage.followPath()</code> fire a callback multiple times
as they progress through from the Pathroot through all Pathitem within that
Dataset / Datakey. The callbacks between these functions should be 
consistent so this function is used called as a step towards unifying the
code to fire that callback.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Root} <code>root</code></strong></li>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Function} <code>func</code></strong></li>
<li><strong>@return {Number}</strong> The first non-zero Errorcode return by func (note, 
it still continues running).</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_fireFollowInformationTypeForRoot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">perhapsSetErr</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">inErr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">err</span> <span class="o">=</span> <span class="nx">inErr</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="p">[</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_i&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">perhapsSetErr</span><span class="p">(</span>
      <span class="nx">func</span><span class="p">(</span>
        <span class="nx">key</span><span class="p">,</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_removePrivatePathStorageData</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">_i</span><span class="p">),</span>
        <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">INFO</span>
      <span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_s&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">perhapsSetErr</span><span class="p">(</span>
      <span class="nx">func</span><span class="p">(</span>
        <span class="nx">key</span><span class="p">,</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_removePrivatePathStorageData</span><span class="p">(</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">]),</span>
        <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">ROOTITEM</span>
      <span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">paths</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">k</span> <span class="o">!==</span> <span class="nx">path</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">k</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[a-z]$/</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">paths</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">perhapsSetErr</span><span class="p">(</span>
    <span class="nx">func</span><span class="p">(</span>
      <span class="nx">key</span><span class="p">,</span>
      <span class="nx">paths</span><span class="p">,</span>
      <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">OTHER_PATHS</span>
    <span class="p">)</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="nx">err</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._calculatelink()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._calculatelink()" name="syncit_path_asynclocalstorage._calculatelink()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._calculateLink()
  </h2>
</div>

  </div>
  <div class="body"><p>Gets a presentable version the link between Pathitem given a Dataset, 
Datakey and Reference.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Reference} <code>reference</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_calculateLink</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.followpath()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.followpath()" name="syncit_path_asynclocalstorage.followpath()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.followPath()
  </h2>
</div>

  </div>
  <div class="body"><p>Will follow all the way from Pathroot through to the final Pathitem of a
Dataset / Datakey / Path calling <code>forEvery</code> for every piece of information
found.</p>

<p>Currently supported information types can be found by looking in 
SyncIt_Constant.FollowInformationType.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Function} <code>forEvery</code></strong> Signature(key, data, informationType)
<ul><li><strong>@param {String} <code>key</code></strong> The current key of the underlying storage, will
be [dataset].[datakey]:[path] for Pathroot.</li>
<li><strong>@param {Object} <code>data</code></strong> The <code>informationType</code> stored at <code>key</code>.</li>
<li><strong>@param {Number} <code>informationType</code></strong> The type of data that the callback
has been called for.</li></ul></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err) This will be called
when reading has finished.
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">followPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">forEvery</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">path</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">_fireFollowInformationTypeForRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">forEvery</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">follow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ref</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_getPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">ref</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">nextRef</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">nextRef</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">_n</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">forEvery</span><span class="p">(</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_calculateLink</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">ref</span><span class="p">),</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_removePrivatePathStorageData</span><span class="p">(</span><span class="nx">item</span><span class="p">),</span>
          <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">PATHITEM</span>
        <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nextRef</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">follow</span><span class="p">(</span><span class="nx">nextRef</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="nx">follow</span><span class="p">(</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">);</span>

  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._createanonymouspath()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._createanonymouspath()" name="syncit_path_asynclocalstorage._createanonymouspath()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._createAnonymousPath()
  </h2>
</div>

  </div>
  <div class="body"><p>Adds Pathitem which are connected to each other, but nothing else.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Array} <code>pathitems</code></strong> An array of Pathitem.</li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_createAnonymousPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">pathitems</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">refs</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">pathitems</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span>
    <span class="nx">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">pathitems</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">pos</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">pos</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">refs</span><span class="p">[</span><span class="nx">pos</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ed</span><span class="p">.</span><span class="nx">encode</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">pos</span> <span class="o">=</span> <span class="nx">pathitems</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">pushOne</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span> <span class="o">!==</span> <span class="nx">pathitems</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pathitems</span><span class="p">[</span><span class="nx">pos</span><span class="p">].</span><span class="nx">_n</span> <span class="o">=</span> <span class="nx">refs</span><span class="p">[</span><span class="nx">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_setPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">refs</span><span class="p">[</span><span class="nx">pos</span><span class="p">],</span><span class="nx">pathitems</span><span class="p">[</span><span class="nx">pos</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">pos</span><span class="o">--</span><span class="p">;</span>
      <span class="nx">pushOne</span><span class="p">();</span>
    <span class="p">});</span>

  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="nx">pushOne</span><span class="p">();</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.pushpathitemstonewpath()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.pushpathitemstonewpath()" name="syncit_path_asynclocalstorage.pushpathitemstonewpath()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.pushPathitemsToNewPath()
  </h2>
</div>

  </div>
  <div class="body"><p>Will add a series of Pathitem to a Path, that path must not already exist.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Array} <code>pathitems</code></strong> Array of Pathitem</li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pushPathitemsToNewPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">pathitems</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">err</span> <span class="o">=</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
      <span class="nx">root</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">path</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">PATH_ALREADY_EXISTS</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_createAnonymousPath</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">pathitems</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">firstRef</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nx">_n</span><span class="o">:</span> <span class="nx">firstRef</span><span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_setRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="nx">next</span><span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.push()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.push()" name="syncit_path_asynclocalstorage.push()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.push()
  </h2>
</div>

  </div>
  <div class="body"><p>Adds a Pathitem to a Path, unless there is no Pathroot, in which case a
Pathroot will be created.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Pathitem} <code>pathitem</code></strong></li>
<li><strong>@param {Boolean} <code>mustBeSinglePath</code></strong> If this is true then adding will
fail if there is more than one Path.</li>
<li><strong>@param {Function} <code>forEvery</code></strong> Called for the Pathroot and Pathitem upto
the point that the Pathitem is added, it will also then be called for
the new <code>Pathitem</code>. If this function does not return 
SyncIt_Constant.Error.OK then <code>push()</code> will terminate with that Errorcode.
See SyncIt_Path_AsyncLocalStorage.followPath() for further information.</li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">,</span><span class="nx">mustBeSinglePath</span><span class="p">,</span><span class="nx">forEvery</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">doNext</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">reference</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;push&#39;</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">);</span>
      <span class="nx">forEvery</span><span class="p">(</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_calculateLink</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">),</span>
        <span class="nx">pathitem</span><span class="p">,</span>
        <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">PATHITEM</span>
      <span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">,(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="o">?</span> <span class="nx">pathitem</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  
  <span class="kd">var</span> <span class="nx">updateChildPointer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span> <span class="nx">toReference</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_getPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">doNext</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">,</span><span class="nx">reference</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">_n</span> <span class="o">=</span> <span class="nx">toReference</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_setPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doNext</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">toReference</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">follow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">tlid</span><span class="p">,</span><span class="nx">lastitem</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">lastitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">reference</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ed</span><span class="p">.</span><span class="nx">encode</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">doNext</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">reference</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">updateChildPointer</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">tlid</span><span class="p">,</span><span class="nx">reference</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_getPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">lastitem</span><span class="p">.</span><span class="nx">_n</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doNext</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">lastitem</span><span class="p">.</span><span class="nx">_n</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">err</span> <span class="o">=</span> <span class="nx">forEvery</span><span class="p">(</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_calculateLink</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">lastitem</span><span class="p">.</span><span class="nx">_n</span><span class="p">),</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_removePrivatePathStorageData</span><span class="p">(</span><span class="nx">item</span><span class="p">),</span>
        <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">PATHITEM</span>
      <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">doNext</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">follow</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">lastitem</span><span class="p">.</span><span class="nx">_n</span><span class="p">,</span> <span class="nx">item</span><span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">kCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">root</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">path</span><span class="p">)))</span> <span class="p">{</span>
      <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mustBeSinglePath</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[a-z]$/</span><span class="p">)</span> <span class="o">||</span> <span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nx">kCount</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">MULTIPLE_PATHS_FOUND</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">err</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fireFollowInformationTypeForRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">forEvery</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">doNext</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">reference</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ed</span><span class="p">.</span><span class="nx">encode</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">doNext</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">reference</span><span class="p">);</span> <span class="p">}</span>
        <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span> <span class="o">=</span> <span class="nx">reference</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">doNext</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">reference</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doNext</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">err</span> <span class="o">=</span> <span class="nx">forEvery</span><span class="p">(</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_calculateLink</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">),</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_removePrivatePathStorageData</span><span class="p">(</span><span class="nx">item</span><span class="p">),</span>
        <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">PATHITEM</span>
      <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">doNext</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">follow</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span><span class="p">,</span><span class="nx">item</span><span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.getdatasetnames()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.getdatasetnames()" name="syncit_path_asynclocalstorage.getdatasetnames()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.getDatasetNames()
  </h2>
</div>

  </div>
  <div class="body"><p>Lists Dataset names.</p>

<ul>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err,datasets)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li>
<li><strong>@param {Array} <code>datasets</code></strong> An array of Dataset names.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDatasetNames</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">findKeys</span><span class="p">(</span><span class="s1">&#39;*.*&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">datasetDatakey</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">datasetDatakey</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span><span class="nx">datasetDatakey</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.getdatakeysindataset()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.getdatakeysindataset()" name="syncit_path_asynclocalstorage.getdatakeysindataset()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.getDatakeysInDataset()
  </h2>
</div>

  </div>
  <div class="body"><p>Lists the Datakeys within a Dataset.</p>

<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err,datakeys)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li>
<li><strong>@param {Array} <code>datakeys</code></strong> An array of Datakeys found within the Dataset</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">findKeys</span><span class="p">(</span><span class="s1">&#39;*.*&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">datasetDatakey</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">datasetDatakey</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">datasetDatakey</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nx">dataset</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.findfirstdatasetdatakey()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.findfirstdatasetdatakey()" name="syncit_path_asynclocalstorage.findfirstdatasetdatakey()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.findFirstDatasetDatakey()
  </h2>
</div>

  </div>
  <div class="body"><p>Will find the Reference which is lowest and return the Dataset / Datakey
that it is attached to.</p>

<ul>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err, dataset, datakey)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li>
<li><strong>@param {String} <code>dataset</code></strong></li>
<li><strong>@param {String} <code>datakey</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findFirstDatasetDatakey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datasets</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_findFirstDatasetDatakeyReference</span><span class="p">(</span><span class="nx">datasets</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.getfirstpathitemindatasets()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.getfirstpathitemindatasets()" name="syncit_path_asynclocalstorage.getfirstpathitemindatasets()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.getFirstPathitemInDatasets()
  </h2>
</div>

  </div>
  <div class="body"><p>Will find the first Pathitem via the lowest Reference and return it along
with the Dataset, Datakey and Pathitem.</p>

<ul>
<li><strong>@param {Array|null} <code>datasets</code></strong> An array of datasets which are acceptable, or null for any.</li>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err, dataset, datakey, reference, pathitem)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li>
<li><strong>@param {String} <code>dataset</code></strong></li>
<li><strong>@param {String} <code>datakey</code></strong></li>
<li><strong>@param {String} <code>reference</code></strong></li>
<li><strong>@param {Pathitem} <code>pathitem</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFirstPathitem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datasets</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_findFirstDatasetDatakeyReference</span><span class="p">(</span>
    <span class="nx">datasets</span><span class="p">,</span>
    <span class="nx">path</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage._findfirstdatasetdatakeyreference()">
  <h2>
    <a href="#syncit_path_asynclocalstorage._findfirstdatasetdatakeyreference()" name="syncit_path_asynclocalstorage._findfirstdatasetdatakeyreference()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage._findFirstDatasetDatakeyReference()
  </h2>
</div>

  </div>
  <div class="body"><p>Will find the lowest Reference and return it along with the Dataset, Datakey
it was found at.</p>

<ul>
<li><strong>@param {Array|null} <code>datasets</code></strong> An array of datasets which are acceptable, or null for any</li>
<li><strong>@param {Path} <code>path</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_findFirstDatasetDatakeyReference</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datasets</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">findKeys</span><span class="p">(</span><span class="s1">&#39;*.*.*&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">keys</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ed</span><span class="p">.</span><span class="nx">sort</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">processOne</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">PATH_EMPTY</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">k</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">processOne</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nx">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">keys</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
          <span class="k">return</span> <span class="nx">processOne</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span>
          <span class="p">(</span><span class="nx">datasets</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
          <span class="p">(</span><span class="nx">datasets</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">processOne</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span>
          <span class="nx">root</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
          <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
          <span class="nx">root</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">_n</span> <span class="o">==</span> <span class="nx">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nx">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="nx">processOne</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">processOne</span><span class="p">();</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>

<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">purge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">findKeys</span><span class="p">(</span><span class="nx">dataset</span> <span class="o">+</span> <span class="s1">&#39;.*&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">rootKeys</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">findKeys</span><span class="p">(</span><span class="nx">dataset</span> <span class="o">+</span> <span class="s1">&#39;.*.*&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">pathKeys</span><span class="p">)</span> <span class="p">{</span>
      
      <span class="kd">var</span> <span class="nx">toProccess</span> <span class="o">=</span> <span class="nx">rootKeys</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">pathKeys</span><span class="p">);</span>
      
      <span class="kd">var</span> <span class="nx">removeOne</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">toProccess</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">__removeItem</span><span class="p">(</span><span class="nx">toProccess</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span> <span class="nx">removeOne</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      
      <span class="nx">removeOne</span><span class="p">();</span>
      
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_path_asynclocalstorage.clean()">
  <h2>
    <a href="#syncit_path_asynclocalstorage.clean()" name="syncit_path_asynclocalstorage.clean()" class="pilcrow">&#182;</a>
    SyncIt_Path_AsyncLocalStorage.clean()
  </h2>
</div>

  </div>
  <div class="body"><p>This function will find disconnected Pathitem and delete them.</p>

<p>When adding Pathitem SyncIt_Path_AsyncLocalStorage will first create the 
Pathitem and then link it. This means that the main datastructure will
stay consistent but it also means that if things go wrong it can leave
a disconnected Pathitem.</p>

<p>Note, this probably should not be done while other data is being be added.</p>

<ul>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {Errorcode} <code>err</code></strong></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">Als</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clean</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56">&#182;</a>
</div>
<p>TODO This should be possible to do per Dataset / Datakey as aposed to
for the whole database at once, this might give nicer code and lower
memory consumption.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57">&#182;</a>
</div>
<p>Get all non root data points</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">getAllKeysAsObj</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">findKeys</span><span class="p">(</span><span class="s1">&#39;*.*.*&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">allKeysWithoutNamespace</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="nx">r</span> <span class="o">=</span> <span class="p">{};</span>

      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">allKeysWithoutNamespace</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">k</span> <span class="o">=</span> <span class="nx">allKeysWithoutNamespace</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="nx">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">}</span>
        <span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="nx">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nx">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  
  <span class="kd">var</span> <span class="nx">flattenNotVisited</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">notVisited</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">datasetK</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">datakeyK</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">refK</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      
    <span class="k">for</span> <span class="p">(</span><span class="nx">datasetK</span> <span class="k">in</span> <span class="nx">notVisited</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">notVisited</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">datasetK</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">datakeyK</span> <span class="k">in</span> <span class="nx">notVisited</span><span class="p">[</span><span class="nx">datasetK</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">notVisited</span><span class="p">[</span><span class="nx">datasetK</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">datakeyK</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">refK</span> <span class="k">in</span> <span class="nx">notVisited</span><span class="p">[</span><span class="nx">datasetK</span><span class="p">][</span><span class="nx">datakeyK</span><span class="p">])</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">notVisited</span><span class="p">[</span><span class="nx">datasetK</span><span class="p">][</span><span class="nx">datakeyK</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">refK</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
                  <span class="p">{</span><span class="nx">dataset</span><span class="o">:</span> <span class="nx">datasetK</span><span class="p">,</span> <span class="nx">datakey</span><span class="o">:</span> <span class="nx">datakeyK</span><span class="p">,</span> <span class="nx">ref</span><span class="o">:</span> <span class="nx">refK</span><span class="p">}</span>
                <span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">removeItems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">notVisited</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">flattenedNotVisited</span> <span class="o">=</span> <span class="nx">flattenNotVisited</span><span class="p">(</span><span class="nx">notVisited</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">doRemove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      
      <span class="kd">var</span> <span class="nx">keyInfo</span> <span class="o">=</span> <span class="p">{};</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">flattenedNotVisited</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">keyInfo</span> <span class="o">=</span> <span class="nx">flattenedNotVisited</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_removePathItem</span><span class="p">(</span>
        <span class="nx">keyInfo</span><span class="p">.</span><span class="nx">dataset</span><span class="p">,</span>
        <span class="nx">keyInfo</span><span class="p">.</span><span class="nx">datakey</span><span class="p">,</span>
        <span class="nx">keyInfo</span><span class="p">.</span><span class="nx">ref</span><span class="p">,</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">doRemove</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="nx">doRemove</span><span class="p">();</span>

  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  
  <span class="nx">getAllKeysAsObj</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">refsStillToBeVisited</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
  
    <span class="kd">var</span> <span class="nx">follow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">data</span><span class="p">,</span><span class="nx">innerNext</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_n&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">innerNext</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">delete</span> <span class="nx">refsStillToBeVisited</span><span class="p">[</span><span class="nx">dataset</span><span class="p">][</span><span class="nx">datakey</span><span class="p">][</span><span class="nx">data</span><span class="p">.</span><span class="nx">_n</span><span class="p">];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_getPathItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">data</span><span class="p">.</span><span class="nx">_n</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">innerNext</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">follow</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">data</span><span class="p">,</span><span class="nx">innerNext</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">followRoot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">innerNext</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_getRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
          <span class="nx">mainErr</span> <span class="o">=</span> <span class="nx">err</span><span class="p">,</span>
          <span class="nx">toComplete</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">innerNext</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="kd">var</span> <span class="nx">finishedMonitor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">toComplete</span> <span class="o">=</span> <span class="nx">toComplete</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">mainErr</span> <span class="o">=</span> <span class="nx">err</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">toComplete</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">innerNext</span><span class="p">(</span><span class="nx">mainErr</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">toComplete</span> <span class="o">=</span> <span class="nx">toComplete</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="nx">follow</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">data</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span><span class="nx">finishedMonitor</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">processDataset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">innerNext</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">datakeys</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">toComplete</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nx">mainErr</span> <span class="o">=</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span> 
          <span class="k">return</span> <span class="nx">innerNext</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">finishedMonitor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">toComplete</span><span class="o">--</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">mainErr</span> <span class="o">=</span> <span class="nx">err</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">toComplete</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">innerNext</span><span class="p">(</span><span class="nx">mainErr</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">toComplete</span><span class="o">=</span><span class="nx">l</span><span class="o">=</span><span class="nx">datakeys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">followRoot</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakeys</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">finishedMonitor</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">cleanOrphaned</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">removeOne</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">__removeItem</span><span class="p">(</span>
          <span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">datakey</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">ref</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span>
          <span class="nx">removeOne</span>
        <span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="nx">removeOne</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">getDatasetNames</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">datasets</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">datasets</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cleanOrphaned</span><span class="p">(</span>
          <span class="nx">flattenNotVisited</span><span class="p">(</span><span class="nx">refsStillToBeVisited</span><span class="p">),</span>
          <span class="nx">next</span>
        <span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">mainErr</span> <span class="o">=</span> <span class="nx">err</span><span class="p">,</span>
        <span class="nx">toComplete</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">finishedMonitor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">toComplete</span><span class="o">--</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">mainErr</span> <span class="o">=</span> <span class="nx">err</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">toComplete</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">mainErr</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">mainErr</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">removeItems</span><span class="p">(</span>
            <span class="nx">refsStillToBeVisited</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
              <span class="nx">cleanOrphaned</span><span class="p">(</span>
                <span class="nx">flattenNotVisited</span><span class="p">(</span><span class="nx">refsStillToBeVisited</span><span class="p">),</span>
                <span class="nx">next</span>
              <span class="p">);</span>
            <span class="p">}</span>
          <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">toComplete</span><span class="o">=</span><span class="nx">l</span><span class="o">=</span><span class="nx">datasets</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span> <span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">processDataset</span><span class="p">(</span><span class="nx">datasets</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">finishedMonitor</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="p">};</span>

<span class="nx">addEvents</span><span class="p">(</span><span class="nx">Als</span><span class="p">,[</span><span class="s1">&#39;set-root&#39;</span><span class="p">,</span><span class="s1">&#39;set-item&#39;</span><span class="p">,</span><span class="s1">&#39;remove-item&#39;</span><span class="p">,</span><span class="s1">&#39;advance&#39;</span><span class="p">,</span><span class="s1">&#39;push&#39;</span><span class="p">,</span><span class="s1">&#39;change-path&#39;</span><span class="p">,</span><span class="s1">&#39;change-root&#39;</span><span class="p">]);</span>

<span class="k">return</span> <span class="nx">Als</span><span class="p">;</span>

<span class="p">}(</span><span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;../Constant&#39;</span><span class="p">),</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;add-events&#39;</span><span class="p">)));</span>

<span class="p">},{</span><span class="s2">&quot;../Constant&quot;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;add-events&quot;</span><span class="o">:</span><span class="mi">12</span><span class="p">}],</span><span class="mi">5</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">,</span> <span class="nx">addEvents</span><span class="p">,</span> <span class="nx">addLocking</span><span class="p">,</span> <span class="nx">updateResult</span><span class="p">)</span> <span class="p">{</span>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="kd">var</span> <span class="nx">LOCKING</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">ERROR</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">FollowInformationType</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>_map()</strong></p>
  </div>
  <div class="body"><p>Simple map function for when Array.map() is not available.</p>

<ul>
<li><strong>@param {Array} <code>arr</code></strong> The array to filter.</li>
<li><strong>@param {Function} <code>filterFunc</code></strong> The function to use for filtering</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">_map</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">map</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">func</span><span class="p">);</span> <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">func</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>_filter()</strong></p>
  </div>
  <div class="body"><p>Simple filter function for when Array.filter() is not available.</p>

<ul>
<li><strong>@param {Array} <code>arr</code></strong> The array to filter.</li>
<li><strong>@param {Function} <code>filterFunc</code></strong> The function to use for filtering</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">_filter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span><span class="nx">filterFunc</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">filterFunc</span><span class="p">);</span> <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">filterFunc</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>_shallowCopyKeys()</strong></p>
  </div>
  <div class="body"><p>Will make a shallow copy of <code>ob</code> containing <code>keysToCopy</code>. If <code>copyNullEtc</code>
is true it will not copy <code>null</code> or <code>undefined</code> values.</p>

<ul>
<li><strong>@param {Object} <code>ob</code></strong></li>
<li><strong>@param {Array} <code>keysToCopy</code></strong></li>
<li><strong>@param {Boolean} <code>copyNullEtc</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">_shallowCopyKeys</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">keysToCopy</span><span class="p">,</span><span class="nx">copyNullEtc</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span>
      <span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="p">(</span>
        <span class="p">(</span><span class="nx">keysToCopy</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="nx">keysToCopy</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">copyNullEtc</span> <span class="o">||</span> <span class="p">((</span><span class="nx">ob</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">ob</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ob</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit">
  <h2>
    <a href="#syncit" name="syncit" class="pilcrow">&#182;</a>
    SyncIt
  </h2>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="new%20syncit()">
  <h3>
    <a href="#new%20syncit()" name="new%20syncit()" class="pilcrow">&#182;</a>
    new SyncIt()
  </h3>
</div>


<p>Constructor</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {SyncIt_Path_AsyncLocalStorage} <code>pathstore</code></strong> The instance to use for storage.</li>
<li><strong>@param {Modifier} <code>modifier</code></strong> The UNIQUE User/Device which is using the instance of SyncIt.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">SyncIt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pathstore</span><span class="p">,</span> <span class="nx">modifier</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span> <span class="o">=</span> <span class="nx">pathstore</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_modifier</span> <span class="o">=</span> <span class="nx">modifier</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">ob</span><span class="p">));</span> <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_autoClean</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._getPathWatcher()</strong></p>
  </div>
  <div class="body"><p>This is used within SyncIt to connect information about that data stored in
SyncIt._ps (An instance of SyncIt_Path_AsyncLocalStorage) and the logical
values that are stored should all Pathitem be processed.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getPathWatcher</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>getWatcher()</strong></p>
  </div>
  <div class="body"><p>Watches as SyncIt_Path_AsyncLocalStorage follows the path of Pathitem
and collects information.</p>

<p>This will also prevent</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">getWatcher</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">inWhere</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">keyInfo</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65">&#182;</a>
</div>
<p>Info stored at the root only exists once and can probably be
seen as metadata, so just connect it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">INFO</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">j</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66">&#182;</a>
</div>
<p>This is not infact the true root, but the root of the Path, if
the <code>dataset</code>/<code>datakey</code> has never been <code>SyncIt.advance()</code>'d then
there will be no root so this will not be called.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">ROOTITEM</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">val</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">keyInfo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">keyInfo</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span> <span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67">&#182;</a>
</div>
<p>getWatcher is always used for collecting information about one
path inside a <code>dataset</code>/<code>datakey</code>, however there is an
opportunity to collect information about whether other paths
exist or not. This will be an array of the non-follwed path.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">OTHER_PATHS</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">p</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68">&#182;</a>
</div>
<p>For every Pathitem that is encounted, we will use updateResult
to figure out the logical value should all the Pathitem be
applied.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">PATHITEM</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getKeyTimeDecoder</span><span class="p">().</span><span class="nx">call</span><span class="p">(</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">,</span>
            <span class="nx">key</span>
          <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">q</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="nx">updateResult</span><span class="p">(</span>
          <span class="nx">val</span><span class="p">,</span>
          <span class="nx">item</span><span class="p">,</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span>
        <span class="p">);</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">keyInfo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">keyInfo</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">o</span> <span class="o">==</span> <span class="s1">&#39;remove&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span> <span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>getReaditem</strong></p>
  </div>
  <div class="body"><p>Returns the data collected by <code>getWatcher</code>.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">getReaditem</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.setclonefunction()">
  <h3>
    <a href="#syncit.setclonefunction()" name="syncit.setclonefunction()" class="pilcrow">&#182;</a>
    SyncIt.setCloneFunction()
  </h3>
</div>

  </div>
  <div class="body"><p>Sometimes, SyncIt wants a deep copy of an Object, this function will allow 
you to change what function does that deep copying.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>

  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cloneFunction
</span>
      <span class="dox_type">Function</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setCloneFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cloneFunction</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span> <span class="o">=</span> <span class="nx">cloneFunction</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getmodifier()">
  <h3>
    <a href="#syncit.getmodifier()" name="syncit.getmodifier()" class="pilcrow">&#182;</a>
    SyncIt.getModifier()
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Modifier}</strong> The User/Device which is using the instance of SyncIt.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getModifier</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_modifier</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenforaddedtopath()">
  <h3>
    <a href="#syncit.listenforaddedtopath()" name="syncit.listenforaddedtopath()" class="pilcrow">&#182;</a>
    SyncIt.listenForAddedToPath()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is added to the <em>Queue</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(operation, dataset, datakey)</code>.
<ul><li><strong>@param {Dataset} <code>listener.dataset</code></strong> The <em>dataset</em> of the updated.</li>
<li><strong>@param {Datakey} <code>listener.datakey</code></strong> The <em>datakey</em> that was updated.</li>
<li><strong>@param {Pathitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> that was just added.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForAddedToPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;added_to_queue&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenforadvanced()">
  <h3>
    <a href="#syncit.listenforadvanced()" name="syncit.listenforadvanced()" class="pilcrow">&#182;</a>
    SyncIt.listenForAdvanced()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is advanced to the <em>Store</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(queueitem, newStorerecord)</code>.
<ul><li><strong>@param {Dataset} <code>listener.dataset</code></strong> The <em>dataset</em> of the advanced.</li>
<li><strong>@param {Datakey} <code>listener.datakey</code></strong> The <em>datakey</em> that was advanced.</li></ul></li>
<li><strong>@param {Pathitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> that was advanced.</li>
<li><strong>@param {Storerecord} <code>listener.newStorerecord</code></strong> The <em>storerecord</em> which is now stored.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForAdvanced</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;advanced&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenforfed()">
  <h3>
    <a href="#syncit.listenforfed()" name="syncit.listenforfed()" class="pilcrow">&#182;</a>
    SyncIt.listenForFed()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is fed using <a href="#syncit.feed--">SyncIt.feed()</a></p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(queueitem, newStorerecord)</code>.
<ul><li><strong>@param {String} <code>listener.dataset</code></strong> The dataset of the just fed Queueitem.</li>
<li><strong>@param {String} <code>listener.datakey</code></strong> The datakey of the just fed Queueitem.</li></ul></li>
<li><strong>@param {Queueitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> that was advanced.</li>
<li><strong>@param {Storerecord} <code>listener.newStorerecord</code></strong> The <em>storerecord</em> which is now stored.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForFed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;fed&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.set()">
  <h3>
    <a href="#syncit.set()" name="syncit.set()" class="pilcrow">&#182;</a>
    SyncIt.set()
  </h3>
</div>

  </div>
  <div class="body"><p>Will add a <em>Pathitem</em> that represents a complete overwrite of any existing data.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Update} <code>update</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Fired after the <em>Queue</em> has been updated. See <a href="#syncit._addtoqueue--">SyncIt._addToQueue()</a>** for documentation.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToQueue</span><span class="p">(</span>
    <span class="s1">&#39;set&#39;</span><span class="p">,</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="nx">update</span><span class="p">,</span>
    <span class="nx">whenAddedToQueue</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.remove()">
  <h3>
    <a href="#syncit.remove()" name="syncit.remove()" class="pilcrow">&#182;</a>
    SyncIt.remove()
  </h3>
</div>

  </div>
  <div class="body"><p>This will add a Pathitem to the Queue that represents the removal of data stored at a Dataset/Datakey.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Fired after the <em>Queue</em> has been updated. See <a href="#syncit._addtoqueue--">SyncIt._addToQueue()</a>** for documentation.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToQueue</span><span class="p">(</span>
    <span class="s1">&#39;remove&#39;</span><span class="p">,</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="p">{},</span>
    <span class="nx">whenAddedToQueue</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.update()">
  <h3>
    <a href="#syncit.update()" name="syncit.update()" class="pilcrow">&#182;</a>
    SyncIt.update()
  </h3>
</div>

  </div>
  <div class="body"><p>This can update one or more parts of the the data at a single <em>dataset</em> / <em>datakey</em> using something similar to the MongoDB update syntax.</p>


<div class="pilwrap" id="example">
  <h4>
    <a href="#example" name="example" class="pilcrow">&#182;</a>
    Example
  </h4>
</div>


<div class='highlight'><pre><code language=''>syncIt.update(
    'user',
    'jack',
    {'$set': {'eyes.color': 'blue'}},
    function(err, dataset, datakey, queueitem) {
        // The data now includes { eyes: { color: "blue" } } but the rest of
        // the data has been preserved
    }
);
</code></pre></div>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Update} <code>update</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Fired after the <em>Queue</em> has been updated. See <a href="#syncit._addtoqueue--">SyncIt._addToQueue()</a> for documentation.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToQueue</span><span class="p">(</span>
    <span class="s1">&#39;update&#39;</span><span class="p">,</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="nx">update</span><span class="p">,</span>
    <span class="nx">whenAddedToQueue</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.feed()">
  <h3>
    <a href="#syncit.feed()" name="syncit.feed()" class="pilcrow">&#182;</a>
    SyncIt.feed()
  </h3>
</div>

  </div>
  <div class="body"><p>This function is for feeding in external Queueitem from the <em>Respository</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Array} <code>feedQueueitems</code></strong> These are the items which are being fed from the <em>Server</em>.</li>
<li><strong>@param {Function} <code>resolutionFunction</code></strong> Called when conflict occurs, Signature: <code>function(dataset, datakey, storerecord, serverQueueitems, localPathitems, resolved)</code>.
<ul><li><strong>@param {Array} <code>resolutionFunction.dataset</code></strong> The <em>Dataset</em> of the conflict.</li>
<li><strong>@param {Array} <code>resolutionFunction.datakey</code></strong> The <em>Datakey</em> of the conflict.</li>
<li><strong>@param {Array} <code>resolutionFunction.storerecord</code></strong> What is in the local <em>Store</em> for that <em>Dataset</em> / <em>Datakey</em>.</li>
<li><strong>@param {Array} <code>resolutionFunction.localPathitems</code></strong> The <em>Pathitem</em> that has been added using functions such as <a href="#syncit.set--">SyncIt.set()</a> but is now conflicting with the data from the <em>Server</em>.</li>
<li><strong>@param {Array} <code>resolutionFunction.serverQueueitems</code></strong> The extra <em>Queueitem</em> that are on the Server.</li>
<li><strong>@param {Function} <code>resolutionFunction.resolved</code></strong> This should be called from inside resolutionFunction and will add <em>Pathitem</em> after the <em>Server</em> supplied <em>Queueitem</em>. Signature: <code>function(resolved, mergedLocalsToDoAfterwards)</code>
<ul><li><strong>@param {Boolean} <code>resolutionFunction.resolved.resolved</code></strong> use false to halt the feeding, true otherwise</li>
<li><strong>@param {Array} <code>resolutionFunction.resolved.mergedLocalsToDoAfterwards</code></strong> These will be added to the <em>Queue</em> <strong>after</strong> (currently) all serverPathitems have been advanced to the <em>Store</em>.</li></ul></li></ul></li>
<li><strong>@param {Function} <code>feedDone</code></strong> Callback for when done. Signature: <code>function(err, fedItemsFailed)</code>;
<ul><li><strong>@param {Errorcode} <code>feedDone.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Array} <code>feedDone.fedItemsFailed</code></strong> Array of items fed from the <em>Server</em> which could not be processed.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">feed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">feedQueueitems</span><span class="p">,</span> <span class="nx">resolutionFunction</span><span class="p">,</span> <span class="nx">feedDone</span><span class="p">)</span> <span class="p">{</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79">&#182;</a>
</div>
<p>Make a shallow copy of feedQueueitems so when we <code>shift()</code> we are not
fiddling with users data.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">feedQueue</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_shallowCopyKeys</span><span class="p">(</span>
        <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">],</span>
        <span class="kc">false</span>
      <span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">})(</span><span class="nx">feedQueueitems</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80">&#182;</a>
</div>
<p>If a conflict occurs we want to feed the resolutionFunction only items from
the same dataset / datakey that are based on a version higher than the one
currently in the Pathroot.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">prepareServerQueueItemForResolutionFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span> <span class="nx">feedQueue</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">firstQueueitem</span> <span class="o">=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    
    <span class="kd">var</span> <span class="nx">filterFunc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">storerecord</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">b</span> <span class="o">&gt;=</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span><span class="p">);</span>
    <span class="p">};</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">feedQueue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">s</span> <span class="o">!=</span> <span class="nx">firstQueueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">k</span> <span class="o">!=</span> <span class="nx">firstQueueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">)</span>
      <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_filter</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">filterFunc</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">_filter</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">filterFunc</span><span class="p">);</span>
  <span class="p">};</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81">&#182;</a>
</div>
<p>Simple helper function that will unlock SyncIt and call the feedDone callback.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">unlockAndError</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">FEEDING</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
      <span class="nx">err</span><span class="p">,</span>
      <span class="nx">feedQueue</span>
    <span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82">&#182;</a>
</div>
<p>This function is called from resolutionFunction.resolved and will check
that resolutionFunction actually did resolve the conflict, if it did it
will add any resolving PathItem to the "c" (conflict) branch so they can
be applied later and remove all local Pathitem from the "a" branch as 
they conflict with the items sent from the server.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">perhapsResolved</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storedrecord</span><span class="p">,</span><span class="nx">fedForSameDatasetAndDatakey</span><span class="p">,</span><span class="nx">resolved</span><span class="p">,</span><span class="nx">mergePathitem</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="kd">var</span> <span class="nx">sanatizeMergeItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">copyKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">],</span>
        <span class="nx">disallowedKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">],</span>
        <span class="nx">i</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">disallowedKeys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">disallowedKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Merge queue cannot include any &quot;</span> <span class="o">+</span> <span class="nx">disallowedKeys</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">copyKeys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">copyKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">[</span><span class="nx">copyKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">queueitem</span><span class="p">[</span><span class="nx">copyKeys</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">s</span> <span class="o">!=</span> <span class="nx">storedrecord</span><span class="p">.</span><span class="nx">s</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Merge queue cannot use different dataset to stored record&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">k</span> <span class="o">!=</span> <span class="nx">storedrecord</span><span class="p">.</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Merge queue cannot use different datakey to stored record&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">};</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">resolved</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">NOT_RESOLVED</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mergePathitem</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">removePathitemFromPath</span><span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_autoClean</span><span class="p">,</span><span class="nx">next</span><span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83">&#182;</a>
</div>
<p>TODO: Sanitize the merge queue</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

    <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">pushPathitemsToNewPath</span><span class="p">(</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
      <span class="s1">&#39;c&#39;</span><span class="p">,</span>
      <span class="nx">_map</span><span class="p">(</span><span class="nx">mergePathitem</span><span class="p">,</span><span class="nx">sanatizeMergeItem</span><span class="p">),</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">feedQueue</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="p">{</span><span class="nx">cv</span><span class="o">:</span> <span class="nx">storedrecord</span><span class="p">.</span><span class="nx">v</span> <span class="o">+</span> <span class="nx">fedForSameDatasetAndDatakey</span><span class="p">.</span><span class="nx">length</span><span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">setInfo</span><span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span><span class="nx">info</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">removePathitemFromPath</span><span class="p">(</span>
            <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
            <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
            <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_autoClean</span><span class="p">,</span>
            <span class="nx">next</span>
          <span class="p">);</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">);</span>
    
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84">&#182;</a>
</div>
<p>One by one, process the Pathitem which have been fed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">feedOne</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">feedQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">FEEDING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,[]);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">storerecord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">otherpaths</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">queue</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="p">{};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85">&#182;</a>
</div>
<p>Read the path, collecting information.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">followPath</span><span class="p">(</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
      <span class="s1">&#39;a&#39;</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">inWhere</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">INFO</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">info</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">ROOTITEM</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">storerecord</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">OTHER_PATHS</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">otherpaths</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">PATHITEM</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">queue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86">&#182;</a>
</div>
<p>It might be that we are trying to feed data which is 
based on an old storerecord, if we are just skip over it</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">feedQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
          <span class="k">return</span> <span class="nx">feedOne</span><span class="p">();</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87">&#182;</a>
</div>
<p>If we have items in our local queue with a basedonversion which is
lower than what we are being fed, it is likely that we have unadvanced
items which we have already uploaded.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">queue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span>
            <span class="nb">Error</span><span class="p">.</span><span class="nx">BASED_ON_IN_QUEUE_LESS_THAN_BASED_IN_BEING_FED</span><span class="p">,</span>
            <span class="nx">feedQueue</span>
          <span class="p">);</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88">&#182;</a>
</div>
<p>Continue with the Feed passing the information found from 
this._ps.followPath();Continue with the Feed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">return</span> <span class="nx">feedOneWorker</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span><span class="nx">queue</span><span class="p">,</span><span class="nx">info</span><span class="p">,</span><span class="nx">otherpaths</span><span class="p">);</span>

      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">);</span>
    
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89">&#182;</a>
</div>
<p>All data is now collected about what is in the Path so we can go ahead and
take appropriate action...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">feedOneWorker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span><span class="nx">queue</span><span class="p">,</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-90" id="section-90">&#182;</a>
</div>
<p>If there is items in the Path then feed them into resolutionFunction</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">fedForSameDatasetAndDatakey</span> <span class="o">=</span> <span class="nx">prepareServerQueueItemForResolutionFunction</span><span class="p">(</span>
        <span class="nx">storerecord</span><span class="p">,</span>
        <span class="nx">feedQueue</span>
      <span class="p">);</span>

      <span class="k">return</span> <span class="nx">resolutionFunction</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
        <span class="k">this</span><span class="p">,</span>
        <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
        <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
        <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">storerecord</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">;</span>
          <span class="nx">storerecord</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">storerecord</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">storerecord</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">storerecord</span><span class="p">;</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)()),</span>
        <span class="nx">queue</span><span class="p">,</span>
        <span class="nx">fedForSameDatasetAndDatakey</span><span class="p">,</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">resolved</span><span class="p">,</span><span class="nx">mergePathitem</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">perhapsResolved</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span><span class="nx">fedForSameDatasetAndDatakey</span><span class="p">,</span><span class="nx">resolved</span><span class="p">,</span><span class="nx">mergePathitem</span><span class="p">,</span><span class="nx">feedOne</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-91" id="section-91">&#182;</a>
</div>
<p>Just make sure that the Pathitem is the correct version to apply.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span> <span class="o">!=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">o</span> <span class="o">==</span> <span class="s1">&#39;remove&#39;</span><span class="p">))</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-92" id="section-92">&#182;</a>
</div>
<p>Requests to remove data which is not there... this is probably seeing
a refeed of the delete of queue data which <strong>was</strong> there, but has been
deleted. In this situation just continue.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">feedQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">feedOne</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span>
        <span class="nx">ERROR</span><span class="p">.</span><span class="nx">FEED_VERSION_ERROR</span><span class="p">,</span>
        <span class="nx">feedQueue</span>
      <span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-93" id="section-93">&#182;</a>
</div>
<p>This will basically apply the first Pathitem to the existing
Pathroot, giving the new Pathroot</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">newRoot</span> <span class="o">=</span> <span class="nx">_shallowCopyKeys</span><span class="p">(</span>
      <span class="nx">updateResult</span><span class="p">(</span>
        <span class="nx">storerecord</span><span class="p">,</span>
        <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span>
      <span class="p">),</span>
      <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
    <span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">joinCPathToA</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">baseV</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">changePath</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_autoClean</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">feedQueue</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">followPath</span><span class="p">(</span>
          <span class="nx">dataset</span><span class="p">,</span>
          <span class="nx">datakey</span><span class="p">,</span>
          <span class="s1">&#39;a&#39;</span><span class="p">,</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">storagekey</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">itemtype</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">itemtype</span> <span class="o">!==</span> <span class="nx">FOLLOW_INFORMATION_TYPE</span><span class="p">.</span><span class="nx">PATHITEM</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span>
              <span class="s1">&#39;added_to_queue&#39;</span><span class="p">,</span>
              <span class="nx">dataset</span><span class="p">,</span>
              <span class="nx">datakey</span><span class="p">,</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span>
                <span class="nx">dataset</span><span class="p">,</span>
                <span class="nx">datakey</span><span class="p">,</span>
                <span class="nx">storagekey</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/.*\./</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="nx">item</span><span class="p">,</span>
                <span class="p">{</span> <span class="nx">b</span><span class="o">:</span> <span class="nx">baseV</span><span class="o">++</span> <span class="p">}</span>
              <span class="p">)</span>
            <span class="p">);</span>
            <span class="k">return</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">feedQueue</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">next</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-94" id="section-94">&#182;</a>
</div>
<p>Set the new Pathroot, once this is done, emit the fact an item has
been fed and check that if we should be applying the conflict path
(c), if we should, do so. Once all this is done, go back and call
<code>feedOne()</code> to go and get the next item.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">setPathroot</span><span class="p">(</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
      <span class="s1">&#39;a&#39;</span><span class="p">,</span>
      <span class="nx">newRoot</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">dataset</span> <span class="o">=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">datakey</span> <span class="o">=</span> <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span>
          <span class="s1">&#39;fed&#39;</span><span class="p">,</span>
          <span class="nx">dataset</span><span class="p">,</span>
          <span class="nx">datakey</span><span class="p">,</span>
          <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span>
            <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
            <span class="nx">feedQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span>
            <span class="nx">newRoot</span>
          <span class="p">)</span>
        <span class="p">);</span>
        <span class="nx">feedQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">newRoot</span><span class="p">.</span><span class="nx">v</span> <span class="o">==</span> <span class="nx">info</span><span class="p">.</span><span class="nx">cv</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">joinCPathToA</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">.</span><span class="nx">v</span><span class="p">,</span><span class="nx">feedOne</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">feedOne</span><span class="p">();</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  
  <span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nx">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nx">queueitemValidationError</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-95" id="section-95">&#182;</a>
</div>
<p>If locked, just exit.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
      <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">,</span>
      <span class="nx">feedQueueitems</span>
    <span class="p">);</span>
  <span class="p">}</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-96" id="section-96">&#182;</a>
</div>
<p>Perform basic validation.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">feedQueueitems</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">queueitemValidationError</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_basicValidationForQueueitem</span><span class="p">(</span><span class="nx">feedQueueitems</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">queueitemValidationError</span> <span class="o">!=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
        <span class="nx">queueitemValidationError</span><span class="p">,</span>
        <span class="nx">feedQueueitems</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-97" id="section-97">&#182;</a>
</div>
<p>Then lock</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">FEEDING</span><span class="p">);</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-98" id="section-98">&#182;</a>
</div>
<p>Process the first item.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">feedOne</span><span class="p">();</span>
  
<span class="p">};</span>

<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_basicValidationForQueueitem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">,</span><span class="nx">skips</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span>
    <span class="nx">requiredFields</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">s</span><span class="o">:</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATASET</span><span class="p">,</span>
      <span class="nx">k</span><span class="o">:</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATAKEY</span><span class="p">,</span>
      <span class="nx">o</span><span class="o">:</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_OPERATION</span>
    <span class="p">};</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">requiredFields</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span>
      <span class="nx">requiredFields</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
      <span class="o">!</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">requiredFields</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">DATASET_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATASET</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">DATAKEY_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATAKEY</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">OPERATION_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_OPERATION</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">skips</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">skips</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">m</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">MODIFIER_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_MODIFIER</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-99" id="section-99">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._addToQueue()</strong></p>
  </div>
  <div class="body"><p>Adds a Pathitem to the Queue.</p>

<p><strong>Parameters</strong></p>

<ul>
<li><strong>@param {Operation} <code>operation</code></strong></li>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Update} <code>update</code></strong></li>
<li><strong>@param {Modifier} <code>modifier</code></strong></li>
<li><strong>@param {Basedonversion} <code>basedonversion</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Callback for when adding is complete. Signature: <code>function(errorCode, dataset, datakey, queueitem)</code>
<ul><li><strong>@param {Errorcode} <code>whenAddedToQueue.errorCode</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Dataset} <code>whenAddedToQueue.dataset</code></strong> The Dataset of the Pathitem.</li>
<li><strong>@param {Datakey} <code>whenAddedToQueue.datakey</code></strong> The Datakey of the Pathitem.</li>
<li><strong>@param {Pathitem} <code>whenAddedToQueue.queueitem</code></strong> The Pathitem that has just been added.</li>
<li><strong>@param {Readrecord} <code>whenAddedToQueue.readrecord</code></strong> The now logical value of the data.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_addToQueue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">operation</span><span class="p">,</span> <span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-100" id="section-100">&#182;</a>
</div>
<p>If locked, exit.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">whenAddedToQueue</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">queueitem</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">o</span><span class="o">:</span> <span class="nx">operation</span><span class="p">,</span> 
    <span class="nx">u</span><span class="o">:</span> <span class="nx">update</span>
  <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-101" id="section-101">&#182;</a>
</div>
<p>Adds information which is not necessary to store in the Pathitems itself.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">_makeFullReaditem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataFromStore</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">m</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">(),</span>
      <span class="nx">r</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">};</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">defaults</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dataFromStore</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">dataFromStore</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">defaults</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">dataFromStore</span><span class="p">;</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">pathWatcher</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getPathWatcher</span><span class="p">();</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">ADDING_TO_QUEUE</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="s1">&#39;a&#39;</span><span class="p">,</span>
    <span class="nx">queueitem</span><span class="p">,</span>
    <span class="kc">true</span><span class="p">,</span>
    <span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getWatcher</span><span class="p">(),</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">ref</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">pathWatchedItem</span> <span class="o">=</span> <span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getReaditem</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">ADDING_TO_QUEUE</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">whenAddedToQueue</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span>
        <span class="s1">&#39;added_to_queue&#39;</span><span class="p">,</span>
        <span class="nx">dataset</span><span class="p">,</span>
        <span class="nx">datakey</span><span class="p">,</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">ref</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">,</span><span class="nx">pathWatchedItem</span><span class="p">)</span>
      <span class="p">);</span>
      <span class="nx">whenAddedToQueue</span><span class="p">(</span>
        <span class="nx">err</span><span class="p">,</span>
        <span class="nx">dataset</span><span class="p">,</span>
        <span class="nx">datakey</span><span class="p">,</span>
        <span class="nx">queueitem</span><span class="p">,</span>
        <span class="nx">_makeFullReaditem</span><span class="p">(</span><span class="nx">pathWatchedItem</span><span class="p">)</span>
      <span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-102" id="section-102">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._getEmptyStorerecord()</strong></p>
  </div>
  <div class="body"><p>When advancing a <em>Pathitem</em> either because SyncIt is moving data from the <em>Queue</em> to the <em>Store</em> or just because it is processing a `<a href="#syncit.get--">SyncIt.get()</a> it is possible that no data already exists at the <em>Store</em> for that <em>Dataset</em> / <em>Datakey</em>. It's handy to use this function to get something that looks like stored data to limit code complexity.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">i</span><span class="o">:</span><span class="p">{},</span>
    <span class="nx">v</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
    <span class="nx">j</span><span class="o">:</span><span class="p">{},</span>
    <span class="nx">p</span><span class="o">:</span><span class="p">[],</span>
    <span class="nx">q</span><span class="o">:</span><span class="p">[],</span>
    <span class="nx">r</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
    <span class="nx">t</span><span class="o">:</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">()</span>
  <span class="p">};</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.advance()">
  <h3>
    <a href="#syncit.advance()" name="syncit.advance()" class="pilcrow">&#182;</a>
    SyncIt.advance()
  </h3>
</div>

  </div>
  <div class="body"><p>Applies the very first <em>Pathitem</em> in the <em>Queue</em> onto the data already in the <em>Store</em> for that <em>Dataset</em> / <em>Datakey</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>done</code></strong> Callback when the operation is complete (or not). Signature: <code>function(errorCode, queueitem, storerecord)</code>
<ul><li><strong>@param {ErrorCode} <code>done.errorCode</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Dataset} <code>done.dataset</code></strong></li>
<li><strong>@param {Datakey} <code>done.datakey</code></strong></li>
<li><strong>@param {Pathitem} <code>done.queueitem</code></strong> The <em>Pathitem</em> that was just advanced</li>
<li><strong>@param {Storerecord} <code>done.storerecord</code></strong> The new <em>Storerecord</em></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">advance</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">done</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">ADVANCING</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">addedPathkey</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">findFirstDatasetDatakey</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">ADVANCING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">newRoot</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">advance</span><span class="p">(</span>
      <span class="nx">dataset</span><span class="p">,</span> 
      <span class="nx">datakey</span><span class="p">,</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_autoClean</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">pathRoot</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">newRootCb</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pathRoot</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pathRoot</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">addedPathkey</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-104" id="section-104">&#182;</a>
</div>
<p>Filter to just keys r, v, i and possibly t anything else can
be recreated.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">newRoot</span> <span class="o">=</span> <span class="nx">updateResult</span><span class="p">(</span><span class="nx">pathRoot</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span><span class="p">);</span>
        <span class="nx">newRoot</span> <span class="o">=</span> <span class="nx">_shallowCopyKeys</span><span class="p">(</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">addedPathkey</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">),</span>
          <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">],</span>
          <span class="kc">false</span>
        <span class="p">);</span>
        <span class="nx">newRootCb</span><span class="p">(</span><span class="nx">newRoot</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">ADVANCING</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span>
          <span class="s1">&#39;advanced&#39;</span><span class="p">,</span>
          <span class="nx">dataset</span><span class="p">,</span>
          <span class="nx">datakey</span><span class="p">,</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">addedPathkey</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">),</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">addedPathkey</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">)</span>
        <span class="p">);</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span>
          <span class="nx">err</span><span class="p">,</span>
          <span class="nx">dataset</span><span class="p">,</span>
          <span class="nx">datakey</span><span class="p">,</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">addedPathkey</span><span class="p">,</span><span class="nx">item</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">),</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">addedPathkey</span><span class="p">,</span><span class="nx">newRoot</span><span class="p">)</span>
        <span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-105" id="section-105">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._addObviousInforation</strong></p>
  </div>
  <div class="body"><p>Maybe, all the information got here is not obvious, but it can be calculated
from other information... Every Pathitem must have been created locally so
we must be the modifier, so we don't store that. The modificationtime is 
can also be retrieved from the Pathitem reference.</p>

<p><strong>@param {Dataset} <code>dataset</code></strong>
<strong>@param {Datakey} <code>datakey</code></strong>
<strong>@param {Pathref} <code>reference</code></strong>
<strong>@param {Pathitem} <code>ob</code></strong> The item to add the "obvious" information to.
**@return {Object} <code>ob</code> with the "obvious" information.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_addObviousInforation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">ob</span><span class="p">,</span><span class="nx">extra</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">_shallowCopyKeys</span><span class="p">(</span><span class="nx">ob</span><span class="p">),</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">dataset</span><span class="p">;</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">datakey</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">reference</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">reference</span> <span class="o">===</span> <span class="kc">null</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;No time and no time found in key&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getKeyTimeDecoder</span><span class="p">())(</span><span class="nx">reference</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">extra</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">extra</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">extra</span><span class="p">.</span><span class="nx">b</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">extra</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">extra</span><span class="p">.</span><span class="nx">v</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^_/</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">delete</span> <span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.get()">
  <h3>
    <a href="#syncit.get()" name="syncit.get()" class="pilcrow">&#182;</a>
    SyncIt.get()
  </h3>
</div>

  </div>
  <div class="body"><p>Will retrieve information from SyncIt by reading what is first in the <em>Store</em> and then every <em>Pathitem</em> for the same Dataset / Datakey.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenDataRetrieved</code></strong> Signature: <code>function(err, jreadInfo)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDataRetrieved.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Object} <code>whenDataRetrieved.jreadInfo</code></strong> The requsted information.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenDataRetrieved</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getFull</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getversion()">
  <h3>
    <a href="#syncit.getversion()" name="syncit.getversion()" class="pilcrow">&#182;</a>
    SyncIt.getVersion()
  </h3>
</div>

  </div>
  <div class="body"><p>Will retrieve information about the version in the store.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenVersionFound</code></strong> Signature: <code>function(err, version)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDataRetrieved.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Number} <code>whenDataRetrieved.version</code></strong> The version of the data, 0 means no data found found, 1 is the first version.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getVersion</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenVersionFound</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getFull</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">whenVersionFound</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">([</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">whenVersionFound</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">whenVersionFound</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getfirstindatasets()">
  <h3>
    <a href="#syncit.getfirstindatasets()" name="syncit.getfirstindatasets()" class="pilcrow">&#182;</a>
    SyncIt.getFirstInDatasets()
  </h3>
</div>

  </div>
  <div class="body"><p>Gets the Pathitem which should be next uploaded to the server or will be advanced
should <code>SyncIt.advance()</code> be called.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Array|null} <code>datasets</code></strong> An array of datasets which are acceptable, or null for any</li>
<li><strong>@param {Function} <code>done</code></strong> Callback. Signature: Function(err, pathitem)
<ul><li><strong>@param {ErrorCode} <code>done.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Pathitem} <code>done.pathitem</code></strong> The Pathitem.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFirstInDatasets</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datasets</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getFirstPathitem</span><span class="p">(</span>
    <span class="nx">datasets</span><span class="p">,</span>
    <span class="s1">&#39;a&#39;</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">PATH_EMPTY</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">qi</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">reference</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getRootItem</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">err</span> <span class="o">=</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
          <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">qi</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">v</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">qi</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">);</span>
  
<span class="p">};</span>

<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFirst</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getFirstInDatasets</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">done</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
  </div>
  <div class="body">
<div class="pilwrap" id="syncit.getfull()">
  <h3>
    <a href="#syncit.getfull()" name="syncit.getfull()" class="pilcrow">&#182;</a>
    SyncIt.getFull()
  </h3>
</div>


<p>Will get ALL information for a <em>Dataset</em> / <em>Datakey</em> from SyncIt including metadata.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenDataRetrieved</code></strong> Signature: Function(err, jreadh)
<ul><li><strong>@param {ErrorCode} <code>whenDataRetrieved.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Jread} <code>whenDataRetrieved.jread</code></strong> The requsted information.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFull</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenDataRetrieved</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">pathWatcher</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getPathWatcher</span><span class="p">();</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">followPath</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getWatcher</span><span class="p">(),</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="kd">var</span> <span class="nx">fullData</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">fullData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addObviousInforation</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getReaditem</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fullData</span><span class="p">.</span><span class="nx">r</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">err</span> <span class="o">=</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">fullData</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getdatasetnames()">
  <h3>
    <a href="#syncit.getdatasetnames()" name="syncit.getdatasetnames()" class="pilcrow">&#182;</a>
    SyncIt.getDatasetNames()
  </h3>
</div>

  </div>
  <div class="body"><p>Lists all dataset names in the <em>Store</em>, <em>Queue</em> or both.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>whenDatasetsKnown</code></strong> Signature: <code>function(err, arrayOfNames)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDatasetsKnown.err</code></strong> See <code>SyncIt_Constant.Error</code>.</li>
<li><strong>@param {Array} <code>whenDatasetsKnown.arrayOfNames</code></strong> An array of <em>dataset</em> names</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDatasetNames</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">whenDatasetsKnown</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getDatasetNames</span><span class="p">(</span><span class="nx">whenDatasetsKnown</span><span class="p">);</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getdatakeysindataset()">
  <h3>
    <a href="#syncit.getdatakeysindataset()" name="syncit.getdatakeysindataset()" class="pilcrow">&#182;</a>
    SyncIt.getDatakeysInDataset()
  </h3>
</div>

  </div>
  <div class="body"><p>Lists Datakeys in a Dataset.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>datasetName</code></strong></li>
<li><strong>@param {Function} <code>whenDatakeysKnown</code></strong> Signature: <code>function(err, arrayOfNames)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDatakeysKnown.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Array} <code>whenDatakeysKnown.arrayOfNames</code></strong> An array of <em>Datakey</em> names</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datasetName</span><span class="p">,</span> <span class="nx">whenDatakeysKnown</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span><span class="p">(</span><span class="nx">datasetName</span><span class="p">,</span> <span class="nx">whenDatakeysKnown</span><span class="p">);</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="remove%20any%20outstanding%20uploads%20for%20a%20specific%20dataset%20%2F%20datakey.">
  <h3>
    <a href="#remove%20any%20outstanding%20uploads%20for%20a%20specific%20dataset%20%2F%20datakey." name="remove%20any%20outstanding%20uploads%20for%20a%20specific%20dataset%20%2F%20datakey." class="pilcrow">&#182;</a>
    Remove any outstanding uploads for a specific Dataset / Datakey.
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>next</code></strong> Signature: Function(err)
<ul><li><strong>@param {ErrorCode} <code>next.err</code></strong> See SyncIt_Constant.Error.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">purge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">purge</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.clean()">
  <h3>
    <a href="#syncit.clean()" name="syncit.clean()" class="pilcrow">&#182;</a>
    SyncIt.clean()
  </h3>
</div>

  </div>
  <div class="body"><p>Will remove the remnants of conflict resolution, these <strong>should</strong> only be
<code>cv</code> Info in Root of a Dataset/Datakey but should there be any 
disconnected Pathitem from unsafe shutdowns it will remove those too. Note
that these disconnected Pathitem or old <code>cv</code> records in the Info of the
Dataset / Datakey Root's do not cause ill effects, except for the tiny
amounts of space.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>done</code></strong> Signature: <code>function(err)</code></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clean</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">done</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
  
  <span class="kd">var</span> <span class="nx">cleanDatakey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">pathWatcher</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getPathWatcher</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">followPath</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getWatcher</span><span class="p">(),</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="nx">pathWatcher</span><span class="p">.</span><span class="nx">getReaditem</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">removeConflictInfo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">info</span><span class="p">.</span><span class="nx">j</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">delete</span> <span class="nx">info</span><span class="p">.</span><span class="nx">j</span><span class="p">.</span><span class="nx">cv</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">setInfo</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">info</span><span class="p">.</span><span class="nx">j</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">removeCPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">removePath</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="kc">false</span><span class="p">,</span><span class="nx">removeConflictInfo</span><span class="p">);</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;How did we end up with more than two paths?&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;How did we end up with paths other than &#39;c&#39; and &#39;a&#39;?&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">removeCPath</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">removeConflictInfo</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">cleanDataset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">datakeys</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">todo</span> <span class="o">=</span> <span class="nx">datakeys</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">terminated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">cleanDatakeyCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">terminated</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">terminated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">((</span><span class="o">--</span><span class="nx">todo</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">terminated</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">next</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">todo</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cleanDatakey</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakeys</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">cleanDatakeyCallback</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">getDatasetNames</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">datasets</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">terminated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">todo</span> <span class="o">=</span> <span class="nx">datasets</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">cleanDatasetCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">terminated</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">terminated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="o">--</span><span class="nx">todo</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">terminated</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_ps</span><span class="p">.</span><span class="nx">clean</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
          <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">ERROR</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span> 
      <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">CLEANING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> 
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">todo</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cleanDataset</span><span class="p">(</span><span class="nx">datasets</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">cleanDatasetCallback</span><span class="p">);</span>
    <span class="p">}</span>
    
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="p">};</span>

<span class="nx">addEvents</span><span class="p">(</span><span class="nx">SyncIt</span><span class="p">,[</span><span class="s1">&#39;fed&#39;</span><span class="p">,</span><span class="s1">&#39;advanced&#39;</span><span class="p">,</span><span class="s1">&#39;added_to_queue&#39;</span><span class="p">]);</span>
<span class="nx">addLocking</span><span class="p">(</span><span class="nx">SyncIt</span><span class="p">,</span><span class="nx">LOCKING</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">SyncIt</span><span class="p">;</span>

<span class="p">}(</span>
  <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./Constant.js&#39;</span><span class="p">),</span>
  <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;add-events&#39;</span><span class="p">),</span>
  <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./addLocking.js&#39;</span><span class="p">),</span>
  <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./updateResult.js&#39;</span><span class="p">)</span>
<span class="p">));</span>

<span class="p">},{</span><span class="s2">&quot;./Constant.js&quot;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;./addLocking.js&quot;</span><span class="o">:</span><span class="mi">8</span><span class="p">,</span><span class="s2">&quot;./updateResult.js&quot;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span><span class="s2">&quot;add-events&quot;</span><span class="o">:</span><span class="mi">12</span><span class="p">}],</span><span class="mi">6</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">SyncItConstant</span><span class="p">,</span> <span class="nx">SyncIt</span><span class="p">)</span> <span class="p">{</span>
  
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncitbuffer">
  <h2>
    <a href="#syncitbuffer" name="syncitbuffer" class="pilcrow">&#182;</a>
    SyncItBuffer
  </h2>
</div>

  </div>
  <div class="body"><p>A wrapper that can be used around SyncIt so you can blindly call functions 
that lock SyncIt and they will queue up. </p>

<p>NOTE: This is not unit tested and is perhaps subject to change (may have bugs).</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="kd">var</span> <span class="nx">SyncItBuffer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">syncIt</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* global setInterval */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_syncIt</span> <span class="o">=</span> <span class="nx">syncIt</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_instructions</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_current</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">c</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_current</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_instructions</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_current</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_instructions</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_current</span><span class="p">.</span><span class="nx">a</span><span class="p">);</span>
      <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="nx">SyncItConstant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_current</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_current</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
          <span class="nx">c</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_syncIt</span><span class="p">,</span>
            <span class="nx">arguments</span>
          <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_current</span><span class="p">.</span><span class="nx">f</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_syncIt</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">50</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">mapNonBuffered</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">SyncItBuffer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_syncIt</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_syncIt</span><span class="p">,</span>
      <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">mapBuffered</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">SyncItBuffer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_instructions</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="nx">f</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_syncIt</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span>
      <span class="nx">a</span><span class="o">:</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
      <span class="nx">c</span><span class="o">:</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">});</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">k</span><span class="p">,</span>
  <span class="nx">bufferedFuncs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;purge&#39;</span><span class="p">,</span> <span class="s1">&#39;clean&#39;</span><span class="p">,</span> <span class="s1">&#39;feed&#39;</span><span class="p">,</span> <span class="s1">&#39;advance&#39;</span><span class="p">,</span> <span class="s1">&#39;getFirst&#39;</span><span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^_/</span><span class="p">))</span> <span class="p">{</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">bufferedFuncs</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">mapBuffered</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">mapNonBuffered</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">return</span> <span class="nx">SyncItBuffer</span><span class="p">;</span>

<span class="p">}(</span><span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./Constant.js&#39;</span><span class="p">),</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./SyncIt.js&#39;</span><span class="p">)));</span>

<span class="p">},{</span><span class="s2">&quot;./Constant.js&quot;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;./SyncIt.js&quot;</span><span class="o">:</span><span class="mi">5</span><span class="p">}],</span><span class="mi">7</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-115" id="section-115">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="synclocalstorage">
  <h1>
    <a href="#synclocalstorage" name="synclocalstorage" class="pilcrow">&#182;</a>
    SyncLocalStorage
  </h1>
</div>

  </div>
  <div class="body"><p>A pretty basic wrapper around HTML5's LocalStorage.</p>

<p>Allows the existance of namespaces for easy seperation of data and
automatically serializes and unserializes all data stored within
it.</p>

<p>It is anticipated that a "." is used to seperate information within
a key, although that will only be a factor if you wish to use the 
<code>SyncLocalStorage.findKeys()</code> method.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="new%20synclocalstorage()">
  <h2>
    <a href="#new%20synclocalstorage()" name="new%20synclocalstorage()" class="pilcrow">&#182;</a>
    new SyncLocalStorage()
  </h2>
</div>

  </div>
  <div class="body"><p>Constructor.</p>


<div class="pilwrap" id="parameters">
  <h3>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h3>
</div>


<ul>
<li><strong>@param {LocalStorage} <code>localStorage</code></strong> This should be window.localStorage,
or something that implements that API.</li>
<li><strong>@param {String} <code>namespace</code></strong> This will be included before every value
stored and other functions will only retrieve items with this namespace.</li>
<li><strong>@param {Function} <code>serialize</code></strong> The method to use for serialization (Try JSON.stringify).</li>
<li><strong>@param {Function} <code>unserialize</code></strong> The method to use for unserialization (Try JSON.parse).</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">SyncLocalStorage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">,</span><span class="nx">namespace</span><span class="p">,</span><span class="nx">serialize</span><span class="p">,</span><span class="nx">unserialize</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_serialize</span> <span class="o">=</span> <span class="nx">serialize</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_unserialize</span> <span class="o">=</span> <span class="nx">unserialize</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_ns</span> <span class="o">=</span> <span class="nx">namespace</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-118" id="section-118">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Returns the amount of items stored in the LocalStorage. Note this is not the 
amount of items which are stored within the namespace</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getLength</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="synclocalstorage.prototype.setitem()">
  <h2>
    <a href="#synclocalstorage.prototype.setitem()" name="synclocalstorage.prototype.setitem()" class="pilcrow">&#182;</a>
    SyncLocalStorage.prototype.setItem()
  </h2>
</div>

  </div>
  <div class="body"><p>Sets key k to value v</p>


<div class="pilwrap" id="parameters">
  <h3>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h3>
</div>


<ul>
<li><strong>@param {String} <code>k</code></strong></li>
<li><strong>@param {Object} <code>unserialize</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ns</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="nx">k</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_serialize</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="synclocalstorage.prototype.clear()">
  <h2>
    <a href="#synclocalstorage.prototype.clear()" name="synclocalstorage.prototype.clear()" class="pilcrow">&#182;</a>
    SyncLocalStorage.prototype.clear()
  </h2>
</div>

  </div>
  <div class="body"><p>Removes all items in the namespace.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clear</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLength</span><span class="p">();</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">while</span> <span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="synclocalstorage.prototype.key()">
  <h2>
    <a href="#synclocalstorage.prototype.key()" name="synclocalstorage.prototype.key()" class="pilcrow">&#182;</a>
    SyncLocalStorage.prototype.key()
  </h2>
</div>

  </div>
  <div class="body"><p>Fetches the LocalStorage key at index <code>i</code> if it is within the 
namespace. If it is not within the namespace <code>null</code> will be
returned.</p>


<div class="pilwrap" id="parameters">
  <h3>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h3>
</div>


<ul>
<li><strong>@param {Number} <code>i</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span>
    <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ns</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
    <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_ns</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ns</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">k</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="synclocalstorage.prototype.getitem()">
  <h2>
    <a href="#synclocalstorage.prototype.getitem()" name="synclocalstorage.prototype.getitem()" class="pilcrow">&#182;</a>
    SyncLocalStorage.prototype.getItem()
  </h2>
</div>

  </div>
  <div class="body"><p>Gets the item stored at key <code>k</code> within the namespace.</p>


<div class="pilwrap" id="parameters">
  <h3>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h3>
</div>


<ul>
<li><strong>@param {String} <code>k</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_unserialize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ns</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="nx">k</span><span class="p">));</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="synclocalstorage.prototype.removeitem()">
  <h2>
    <a href="#synclocalstorage.prototype.removeitem()" name="synclocalstorage.prototype.removeitem()" class="pilcrow">&#182;</a>
    SyncLocalStorage.prototype.removeItem()
  </h2>
</div>

  </div>
  <div class="body"><p>Removes the item stored at key <code>k</code>.</p>


<div class="pilwrap" id="parameters">
  <h3>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h3>
</div>


<ul>
<li><strong>@param {String} <code>k</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ns</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="nx">k</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="synclocalstorage.prototype.findkeys()">
  <h2>
    <a href="#synclocalstorage.prototype.findkeys()" name="synclocalstorage.prototype.findkeys()" class="pilcrow">&#182;</a>
    SyncLocalStorage.prototype.findKeys()
  </h2>
</div>

  </div>
  <div class="body"><p>This function will return all keys that a specified pattern.</p>


<div class="pilwrap" id="parameters">
  <h3>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h3>
</div>


<ul>
<li><strong>@param {String} <code>pattern</code></strong> Patterns allow wildcards of "<em>" and use "."
as a seperator. For example 'cars.</em>.large' could return 
'cars.bmw.large' and 'cars.ford.large' but not 'cars.opel.medium'.</li>
<li><strong>@return {Array}</strong> An Array of String.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncLocalStorage</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findKeys</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pattern</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">starIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="nx">buildRe</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">re</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  
  <span class="nx">buildRe</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pattern</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mustBeDot</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[A-Za-z0-9_\.\*]/</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">pattern</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\./g</span><span class="p">,</span><span class="s1">&#39;\\.&#39;</span><span class="p">);</span>
        <span class="nx">starIndex</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">starIndex</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">mustBeDot</span> <span class="o">=</span> <span class="p">[</span><span class="nx">starIndex</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nx">starIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">starIndex</span> <span class="o">==</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mustBeDot</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">starIndex</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mustBeDot</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">mustBeDot</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span>
          <span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">mustBeDot</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
          <span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">mustBeDot</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;\\&#39;</span><span class="p">)</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">pattern</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;[a-z0-9A-Z_\\-]+&#39;</span><span class="p">);</span>
      <span class="nx">starIndex</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="nx">pattern</span><span class="o">+</span><span class="s1">&#39;$&#39;</span><span class="p">);</span>
  <span class="p">};</span>
  
  <span class="nx">re</span> <span class="o">=</span> <span class="nx">buildRe</span><span class="p">(</span><span class="nx">pattern</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">re</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span>
      <span class="s2">&quot;You cannot find keys from the pattern &#39;&quot;</span> <span class="o">+</span> <span class="nx">pattern</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ls</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span>
      <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ns</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_ns</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ns</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="nx">k</span> <span class="o">=</span> <span class="nx">k</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">return</span> <span class="nx">SyncLocalStorage</span><span class="p">;</span>

<span class="p">}());</span>

<span class="p">},{}],</span><span class="mi">8</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-125" id="section-125">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="addlocking()">
  <h1>
    <a href="#addlocking()" name="addlocking()" class="pilcrow">&#182;</a>
    addLocking()
  </h1>
</div>

  </div>
  <div class="body"><p>Adds internal locking to an existing pseudo-classical Javascript class</p>


<div class="pilwrap" id="example">
  <h2>
    <a href="#example" name="example" class="pilcrow">&#182;</a>
    Example
  </h2>
</div>



<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="p">};</span>

<span class="nx">MyClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">doSomething</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// Lock with bitpattern &#39;10&#39;</span>
 <span class="k">this</span><span class="p">.</span><span class="nx">_startSensitiveJob</span><span class="p">();</span>
 <span class="k">this</span><span class="p">.</span><span class="nx">_lockFor</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// Lock with bitpattern &#39;01&#39;, Locks &#39;11&#39; now present.</span>
 <span class="k">this</span><span class="p">.</span><span class="nx">_startSomethingElse</span><span class="p">();</span>
 <span class="k">this</span><span class="p">.</span><span class="nx">_unlockFor</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// Lock is now back at &#39;00&#39;</span>
<span class="p">};</span>

<span class="nx">MyClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">doSomethingElse</span><span class="p">()</span> <span class="p">{</span>
 <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">amILocked</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
   <span class="c1">// It safe to do something as lock &#39;10&#39; is not present.</span>
 <span class="p">}</span>
<span class="p">};</span>

<span class="nx">addLocking</span><span class="p">(</span><span class="nx">MyClass</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="nx">Supports</span> <span class="nx">locks</span> <span class="mi">1</span> <span class="nx">and</span> <span class="mi">2</span>
</code></pre></div>




<div class="pilwrap" id="parameters">
  <h2>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h2>
</div>


<ul>
<li><strong>@param {Function} <code>classFunc</code></strong> The class to add internal locking to.</li>
<li><strong>@param {Array} <code>maxLockingValue</code></strong> maximum bit pattern suported for locking.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">classFunc</span><span class="p">,</span><span class="nx">maxLockingValue</span><span class="p">)</span> <span class="p">{</span> 
  
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_ensureLockingData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_locked&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="class._amilocked()">
  <h3>
    <a href="#class._amilocked()" name="class._amilocked()" class="pilcrow">&#182;</a>
    CLASS._amILocked()
  </h3>
</div>

  </div>
  <div class="body"><p>Checks if SyncIt is locked.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<p><strong>@param {Number} <code>disregardTheseLocks</code></strong> Allowed locks to skip over.
<strong>@return {Boolean}</strong> True if locks other than <code>disregardTheseLocks</code> are present.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_amILocked</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">disregardTheseLocks</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ensureLockingData</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">maxLockingValue</span> <span class="o">^</span> <span class="nx">disregardTheseLocks</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">};</span>
  


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="class._lockfor()">
  <h3>
    <a href="#class._lockfor()" name="class._lockfor()" class="pilcrow">&#182;</a>
    CLASS._lockFor()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds the lock <code>lockType</code></p>

<p><strong>@param {Number} <code>lockType</code></strong> The lock to add.
<strong>@return {Boolean}</strong> False if the lock was already present, True otherwise.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_lockFor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lockType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ensureLockingData</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="nx">lockType</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">|</span> <span class="nx">lockType</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="class._unlockfor()">
  <h3>
    <a href="#class._unlockfor()" name="class._unlockfor()" class="pilcrow">&#182;</a>
    CLASS._unlockFor()
  </h3>
</div>

  </div>
  <div class="body"><p>Removes the lock <code>lockType</code></p>

<p><strong>@param {Number} <code>lockType</code></strong> The lock to remove.
<strong>@return {Boolean}</strong> False if the lock was not present, True otherwise.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_unlockFor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lockType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ensureLockingData</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="nx">lockType</span><span class="p">))</span> <span class="p">{</span> 
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">^</span> <span class="p">(</span><span class="nx">maxLockingValue</span> <span class="o">&amp;</span> <span class="nx">lockType</span><span class="p">);</span>
  <span class="p">};</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="classfunc.islocked()">
  <h3>
    <a href="#classfunc.islocked()" name="classfunc.islocked()" class="pilcrow">&#182;</a>
    classFunc.isLocked()
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Boolean}</strong> True if there are any locks</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isLocked</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ensureLockingData</span><span class="p">();</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="p">}());</span>

<span class="p">},{}],</span><span class="mi">9</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">AsyncLocalStorage</span><span class="o">:</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./AsyncLocalStorage&#39;</span><span class="p">),</span>
  <span class="nx">Constant</span><span class="o">:</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./Constant&#39;</span><span class="p">),</span>
  <span class="nx">SyncIt</span><span class="o">:</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./SyncIt&#39;</span><span class="p">),</span>
  <span class="nx">SyncItBuffer</span><span class="o">:</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./SyncItBuffer&#39;</span><span class="p">),</span>
  <span class="nx">FakeLocalStorage</span><span class="o">:</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./FakeLocalStorage&#39;</span><span class="p">),</span>
  <span class="nx">getTlIdEncoderDecoder</span><span class="o">:</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;get_tlid_encoder_decoder&#39;</span><span class="p">),</span>
  <span class="nx">Path_AsyncLocalStorage</span><span class="o">:</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./Path/AsyncLocalStorage&#39;</span><span class="p">),</span>
  <span class="nx">dontListLocallyDeletedDatakeys</span><span class="o">:</span> <span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./dontListLocallyDeletedDatakeys&#39;</span><span class="p">)</span>
<span class="p">};</span>

<span class="p">},{</span><span class="s2">&quot;./AsyncLocalStorage&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;./Constant&quot;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;./FakeLocalStorage&quot;</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;./Path/AsyncLocalStorage&quot;</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span><span class="s2">&quot;./SyncIt&quot;</span><span class="o">:</span><span class="mi">5</span><span class="p">,</span><span class="s2">&quot;./SyncItBuffer&quot;</span><span class="o">:</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;./dontListLocallyDeletedDatakeys&quot;</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;get_tlid_encoder_decoder&quot;</span><span class="o">:</span><span class="mi">13</span><span class="p">}],</span><span class="mi">10</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">)</span> <span class="p">{</span>
  
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-131" id="section-131">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="dontlistlocallydeleteddatakeys()">
  <h1>
    <a href="#dontlistlocallydeleteddatakeys()" name="dontlistlocallydeleteddatakeys()" class="pilcrow">&#182;</a>
    dontListLocallyDeletedDatakeys()
  </h1>
</div>

  </div>
  <div class="body"><p>Adds a wrapper around <code>SyncIt.getDatakeysInDataset()</code> to make it not list locally
deleted Datakey.</p>

<ul>
<li><strong>@param {SyncIt} <code>syncIt</code></strong> A full SyncIt instance.</li>
<li><strong>@return {SyncIt}</strong> a SyncIt which will no longer list locally deleted datakeys.</li>
<li><strong>@todo</strong> This could be more tightly coupled into SyncIt to dramatically increase performace.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">syncIt</span><span class="p">)</span> <span class="p">{</span> 
  
  <span class="kd">var</span> <span class="nx">origGetDatakeysInDataset</span> <span class="o">=</span> <span class="nx">syncIt</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">syncIt</span><span class="p">);</span>
  
  <span class="nx">syncIt</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">whenDatakeysKnown</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="nx">origGetDatakeysInDataset</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">datakeys</span><span class="p">)</span> <span class="p">{</span>
      
      <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">inError</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">;</span>
      
      <span class="kd">var</span> <span class="nx">_keys</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">k</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
              <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
        <span class="p">};</span>
      
      <span class="kd">var</span> <span class="nx">keysFromNonRemoved</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">k</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">ob</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">r</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
        <span class="p">};</span>
      
      <span class="kd">var</span> <span class="nx">handleGetFull</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">([</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">inError</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
          <span class="nx">inError</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">whenDatakeysKnown</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">r</span><span class="p">[</span><span class="nx">data</span><span class="p">.</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_keys</span><span class="p">(</span><span class="nx">r</span><span class="p">).</span><span class="nx">length</span> <span class="o">==</span> <span class="nx">datakeys</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">whenDatakeysKnown</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">keysFromNonRemoved</span><span class="p">(</span><span class="nx">r</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">};</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">datakeys</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">whenDatakeysKnown</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,[]);</span>
      <span class="p">}</span>
      
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">datakeys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">syncIt</span><span class="p">.</span><span class="nx">getFull</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakeys</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">handleGetFull</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">};</span>
  
  <span class="k">return</span> <span class="nx">syncIt</span><span class="p">;</span>
  
<span class="p">};</span>

<span class="p">}(</span><span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;./Constant&#39;</span><span class="p">)));</span>

<span class="p">},{</span><span class="s2">&quot;./Constant&quot;</span><span class="o">:</span><span class="mi">2</span><span class="p">}],</span><span class="mi">11</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-133" id="section-133">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="makeasync(classfunc%2C%20asynchronousdelay)">
  <h1>
    <a href="#makeasync(classfunc%2C%20asynchronousdelay)" name="makeasync(classfunc%2C%20asynchronousdelay)" class="pilcrow">&#182;</a>
    makeAsync(classFunc, asynchronousDelay)
  </h1>
</div>

  </div>
  <div class="body"><p>Takes a pseudo-classical Javascript class and converts that class into an
asynchronous version.</p>


<div class="pilwrap" id="example">
  <h2>
    <a href="#example" name="example" class="pilcrow">&#182;</a>
    Example
  </h2>
</div>



<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
 <span class="k">this</span><span class="p">.</span><span class="nx">property</span> <span class="o">=</span> <span class="nx">property</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">MyClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getProperty</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">property</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">AsyncMyClass</span> <span class="o">=</span> <span class="nx">makeAsync</span><span class="p">(</span><span class="nx">MyClass</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">asyncMyClass</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AsyncMyClass</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="nx">asyncMyClass</span><span class="p">.</span><span class="nx">getProperty</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
 <span class="c1">// Outputs &quot;Property is 7&quot;</span>
 <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Property is &#39;</span><span class="o">+</span><span class="nx">property</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>




<div class="pilwrap" id="parameters">
  <h2>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h2>
</div>


<ul>
<li><strong>@param {Function} <code>classFunc</code></strong></li>
<li><strong>@param {Number} <code>asynchronousDelay</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">classFunc</span><span class="p">,</span><span class="nx">asynchronousDelay</span><span class="p">)</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-135" id="section-135">&#182;</a>
</div>
<p>This will create the constructor</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">constructorFunc</span>  <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">Factory</span> <span class="o">=</span> <span class="nx">classFunc</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span>
      <span class="nx">classFunc</span><span class="p">,</span>
      <span class="nx">args</span>
    <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_inst</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Factory</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-136" id="section-136">&#182;</a>
</div>
<p>Takes a function and a factor and returns an asynchronous
(if factor != false) function which wraps the func and passes
it's parameters through with the addition of a callback</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">makeLaggy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span><span class="nx">factor</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

      <span class="cm">/* globals setTimeout: false */</span>

      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
        <span class="nx">cb</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">args</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cb</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">factor</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_inst</span><span class="p">,</span><span class="nx">args</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_inst</span><span class="p">,</span><span class="nx">args</span><span class="p">));</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">factor</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-137" id="section-137">&#182;</a>
</div>
<p>This should be an IIFE in the for loop below, except that JSHint complains
about functions in loops</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">proc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">constructorFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">makeLaggy</span><span class="p">(</span><span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span><span class="nx">asynchronousDelay</span><span class="p">);</span>
  <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-138" id="section-138">&#182;</a>
</div>
<p>Look at classFunc and use makeLaggy to attach a asynchronous version of
the function.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">proc</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">constructorFunc</span><span class="p">;</span>

<span class="p">};</span>

<span class="p">}());</span>

<span class="p">},{}],</span><span class="mi">12</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-139" id="section-139">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="addevents()">
  <h1>
    <a href="#addevents()" name="addevents()" class="pilcrow">&#182;</a>
    addEvents()
  </h1>
</div>

  </div>
  <div class="body"><p>Adds events to an existing pseudo-classical Javascript class.</p>

<p>NOTE: Overwrites the following variables within the prototype:</p>

<ul>
<li>_eventTypes</li>
<li>_emit</li>
<li>on</li>
<li>once</li>
<li>removeAllListeners</li>
<li>removeAllOnceListeners</li>
<li>removeOnceListener</li>
<li>removeOnceListener</li>
</ul>

<p>NOTE: Overwrites the following variables within the instance of a class</p>

<ul>
<li>_onceListeners</li>
<li>_listeners</li>
</ul>


<div class="pilwrap" id="example">
  <h2>
    <a href="#example" name="example" class="pilcrow">&#182;</a>
    Example
  </h2>
</div>



<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="p">};</span>

<span class="nx">MyClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">doSomething</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;doneit&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">addEvents</span><span class="p">(</span><span class="nx">MyClass</span><span class="p">,[</span><span class="s1">&#39;doneit&#39;</span><span class="p">]);</span>

<span class="kd">var</span> <span class="nx">myClass</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">myClass</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;doneit&#39;</span><span class="p">,</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
 <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;a = &#39;</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">+</span> <span class="s1">&#39;, b = &#39;</span> <span class="o">+</span> <span class="nx">b</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">myClass</span><span class="p">.</span><span class="nx">doSomething</span><span class="p">();</span>
</code></pre></div>




<div class="pilwrap" id="parameters">
  <h2>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h2>
</div>


<ul>
<li><strong>@param {Function} <code>classFunc</code></strong> The class to add events to.</li>
<li><strong>@param {Array} <code>events</code></strong> The events you want the class to support.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">addEvents</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">classFunc</span><span class="p">,</span> <span class="nx">events</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_eventTypes</span> <span class="o">=</span> <span class="nx">events</span><span class="p">;</span>
  
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_emit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span> <span class="cm">/*, other arguments */</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_eventTypes</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;SyncIt._emit(): Attempting to fire unknown event &#39;&quot;</span> <span class="o">+</span> <span class="nx">event</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">var</span> <span class="nx">toFire</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="k">if</span> <span class="p">(</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_onceListeners&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_onceListeners</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onceListeners</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">toFire</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onceListeners</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">shift</span><span class="p">());</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_listeners&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>

      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">toFire</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">][</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="nx">toFire</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">toFire</span><span class="p">.</span><span class="nx">shift</span><span class="p">().</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span>
    
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">pushTo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">objKey</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">_eventTypes</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;addEvents: Attempting to listen for unknown event &#39;&quot;</span><span class="o">+</span><span class="nx">event</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">objKey</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">event</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>
    
    <span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">][</span><span class="nx">event</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">func</span><span class="p">);</span>
  <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="class.on()">
  <h3>
    <a href="#class.on()" name="class.on()" class="pilcrow">&#182;</a>
    CLASS.on()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds an event listeners to an event</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the event to listen for</li>
<li><strong>@param {Function} <code>listener</code></strong> The listener to fire when event occurs.</li>
</ul>


<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Boolean}</strong> True if that event is available to listen to.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">pushTo</span><span class="p">(</span><span class="s1">&#39;_listeners&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listen</span> <span class="o">=</span> <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">on</span><span class="p">;</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="class.once()">
  <h3>
    <a href="#class.once()" name="class.once()" class="pilcrow">&#182;</a>
    CLASS.once()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds an event listeners which will be called only once then removed</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the event to listen for</li>
<li><strong>@param {Function} <code>listener</code></strong> The listener to fire when event occurs.</li>
</ul>


<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Boolean}</strong> True if that event is available to listen to.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">once</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">pushTo</span><span class="p">(</span><span class="s1">&#39;_onceListeners&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">removeAllListeners</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">objKey</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span> 
    <span class="kd">var</span> <span class="nx">propertyNames</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
      <span class="p">}</span> <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">})(</span><span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">]);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">propertyNames</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[];</span>
    <span class="p">}</span>
    
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">][</span><span class="nx">event</span><span class="p">];</span>
    <span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="class.removealllisteners()">
  <h3>
    <a href="#class.removealllisteners()" name="class.removealllisteners()" class="pilcrow">&#182;</a>
    CLASS.removeAllListeners()
  </h3>
</div>

  </div>
  <div class="body"><p>Removes all non <code>once</code> listeners for a specific event.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the event you want to remove all listeners for.</li>
</ul>


<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Array}</strong> The listeners that have just been removed.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeAllListeners</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">removeAllListeners</span><span class="p">(</span><span class="s1">&#39;_listeners&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">};</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="class.removealloncelisteners()">
  <h3>
    <a href="#class.removealloncelisteners()" name="class.removealloncelisteners()" class="pilcrow">&#182;</a>
    CLASS.removeAllOnceListeners()
  </h3>
</div>

  </div>
  <div class="body"><p>Removes all <code>once</code> listeners for a specific event.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the event you want to remove all listeners for.</li>
</ul>


<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Array}</strong> The listeners that have just been removed.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeAllOnceListeners</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">removeAllListeners</span><span class="p">(</span><span class="s1">&#39;_onceListeners&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">removeListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">objKey</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">replacement</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">successful</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    
    <span class="kd">var</span> <span class="nx">propertyNames</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
      <span class="p">}</span> <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">})(</span><span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">]);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">propertyNames</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">][</span><span class="nx">event</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">][</span><span class="nx">event</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">replacement</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">][</span><span class="nx">event</span><span class="p">][</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">successful</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">ctx</span><span class="p">[</span><span class="nx">objKey</span><span class="p">][</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="nx">replacement</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="nx">successful</span><span class="p">;</span>
  <span class="p">};</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="class.removelistener()">
  <h3>
    <a href="#class.removelistener()" name="class.removelistener()" class="pilcrow">&#182;</a>
    CLASS.removeListener()
  </h3>
</div>

  </div>
  <div class="body"><p>Removes a specific listener from an event (note, not from the <code>once()</code> call).</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the event you want to remove a listener from.</li>
<li><strong>@param {Function} <code>listener</code></strong> The listener you want to remove.</li>
</ul>


<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Boolean}</strong> True if the listener was removed, false otherwise.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">removeListener</span><span class="p">(</span><span class="s1">&#39;_listeners&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="class.removeoncelistener()">
  <h3>
    <a href="#class.removeoncelistener()" name="class.removeoncelistener()" class="pilcrow">&#182;</a>
    CLASS.removeOnceListener()
  </h3>
</div>

  </div>
  <div class="body"><p>Removes a specific listener from an event (note, not from the <code>once()</code> call).</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the event you want to remove a listener from.</li>
<li><strong>@param {Function} <code>listener</code></strong> The listener you want to remove.</li>
</ul>


<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Boolean}</strong> True if the listener was removed, false otherwise.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">classFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeOnceListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">removeListener</span><span class="p">(</span><span class="s1">&#39;_onceListeners&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">};</span>

<span class="p">};</span>

<span class="k">return</span> <span class="nx">addEvents</span><span class="p">;</span>

<span class="p">}());</span>

<span class="p">},{}],</span><span class="mi">13</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="cm">/*jshint smarttabs:true */</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-147" id="section-147">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gettlidencoderdecoder()">
  <h1>
    <a href="#gettlidencoderdecoder()" name="gettlidencoderdecoder()" class="pilcrow">&#182;</a>
    getTLIdEncoderDecoder()
  </h1>
</div>

  </div>
  <div class="body"><p>Generate time based local Id's which are guarenteed to be unique for that
particular constructor call.</p>


<div class="pilwrap" id="parameters">
  <h2>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h2>
</div>


<ul>
<li><strong>@param {Number} <code>epoch</code></strong> A timestamp, all unique Id's will use this as
thier base time.</li>
<li><strong>@param {Number} <code>uniqueLength</code></strong> Id's will be based on a timestamp and a
extra sequence number if we happen to generate two Id's in the same 
millisecond. If you leave this at the default of 1, 32 unique Id's can be
generated per millisecond (because it's a 32bit number represented in a
string), I have found this to be sufficient, but you can increase this
number if it is not.</li>
<li><strong>@return {Object} <code>return</code></strong> The return value includes three seperate Functions, 
these are:</li>
<li><strong>@return {Function} <code>return.encode</code></strong> Encode now by default (or the
first parameter) into an Id.</li>
<li><strong>@return {Function} <code>return.decode</code></strong> Decode an Id back into a 
timestamp (Id is the first parameter).</li>
<li><strong>@return {Function} <code>return.sort</code></strong> Compatible with Array.sort() and
will soft based on the encode time / first parameter.</li>
</ul>


<div class="pilwrap" id="example">
  <h2>
    <a href="#example" name="example" class="pilcrow">&#182;</a>
    Example
  </h2>
</div>



<div class="highlight"><pre><code><span class="c1">// Use one character (32 bit number) to ensure uniqueness within a millisecond</span>
<span class="kd">var</span> <span class="nx">uniquenessPerMillisecond</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">// As close as possible (but lower) than the lowest date to give shorter Id&#39;s</span>
<span class="kd">var</span> <span class="nx">epoch</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>

<span class="c1">// Get the TLId Encoder / Decoder</span>
<span class="kd">var</span> <span class="nx">encoderDecoder</span> <span class="o">=</span> <span class="nx">getTLIdEncoderDecoder</span><span class="p">(</span><span class="nx">epoch</span><span class="p">,</span><span class="nx">uniquenessPerMillisecond</span><span class="p">);</span>

<span class="c1">// Encode a date into a unique string</span>
<span class="kd">var</span> <span class="nx">dates</span> <span class="o">=</span> <span class="p">[</span>
  <span class="nx">encoderDecoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(),</span>
  <span class="nx">encoderDecoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">).</span><span class="nx">getTime</span><span class="p">()),</span>
  <span class="nx">encoderDecoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">1981</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">).</span><span class="nx">getTime</span><span class="p">()),</span>
  <span class="nx">encoderDecoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">1986</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">).</span><span class="nx">getTime</span><span class="p">()),</span>
  <span class="nx">encoderDecoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">1983</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">).</span><span class="nx">getTime</span><span class="p">()),</span>
  <span class="nx">encoderDecoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">1982</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">).</span><span class="nx">getTime</span><span class="p">()),</span>
  <span class="nx">encoderDecoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">()</span>
<span class="p">];</span>

<span class="c1">// Get the dates it was encoded</span>
<span class="kd">var</span> <span class="nx">originalTimestamps</span> <span class="o">=</span> <span class="nx">dates</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">encoderDecoder</span><span class="p">.</span><span class="nx">decode</span><span class="p">);</span>

<span class="c1">// Sort them in date order</span>
<span class="kd">var</span> <span class="nx">sortedDates</span> <span class="o">=</span> <span class="nx">dates</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">encoderDecoder</span><span class="p">.</span><span class="nx">sort</span><span class="p">);</span><span class="o">*</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The first Date is &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">encoderDecoder</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">sortedDates</span><span class="p">[</span><span class="mi">0</span><span class="p">])));</span>
</code></pre></div>


  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">epoch</span><span class="p">,</span><span class="nx">uniqueLength</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">lastDate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">uniqueLength</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">uniqueLength</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">epoch</span> <span class="o">!=</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="s2">&quot;Only takes timestamps&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">genUid</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">now</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">now</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">now</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Only takes timestamps&quot;</span><span class="p">;</span>
  <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="nx">lastDate</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">now</span> <span class="o">!==</span> <span class="nx">lastDate</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">superUnique</span> <span class="o">=</span> <span class="p">(</span><span class="o">++</span><span class="nx">index</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">superUnique</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">uniqueLength</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">superUnique</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">superUnique</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">timeEncoded</span> <span class="o">=</span> <span class="p">(</span><span class="nx">now</span> <span class="o">-</span> <span class="nx">epoch</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">superUnique</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">uniqueLength</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;getUidGenerator.genUid cannot generate TLId until next millisecond!&quot;</span><span class="p">;</span>
  <span class="p">}</span>

    <span class="nx">lastDate</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">timeEncoded</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="s1">&#39;9&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;X&quot;</span><span class="o">+</span><span class="nx">timeEncoded</span><span class="o">+</span><span class="nx">superUnique</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">timeEncoded</span><span class="o">+</span><span class="nx">superUnique</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">uidToTimestamp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tlid</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">tlid</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">tlid</span> <span class="o">=</span> <span class="nx">tlid</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">tlid</span> <span class="o">=</span> <span class="nx">tlid</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">tlid</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">uniqueLength</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">tlid</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span> <span class="o">+</span> <span class="nx">epoch</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">sort</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tlidA</span><span class="p">,</span> <span class="nx">tlidB</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">tlidA</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">tlidA</span> <span class="o">=</span> <span class="nx">tlidA</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">tlidB</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">tlidB</span> <span class="o">=</span> <span class="nx">tlidB</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">tlidA</span> <span class="o">=</span> <span class="nx">tlidA</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/.*\./</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="nx">tlidB</span> <span class="o">=</span> <span class="nx">tlidB</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/.*\./</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">tlidA</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="nx">tlidB</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">tlidA</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">tlidB</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">tlidA</span> <span class="o">&lt;</span> <span class="nx">tlidB</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="k">return</span> <span class="p">{</span><span class="nx">encode</span><span class="o">:</span> <span class="nx">genUid</span><span class="p">,</span> <span class="nx">decode</span><span class="o">:</span> <span class="nx">uidToTimestamp</span><span class="p">,</span> <span class="nx">sort</span><span class="o">:</span> <span class="nx">sort</span><span class="p">};</span>
<span class="p">};</span>

<span class="p">}());</span>

<span class="p">},{}],</span><span class="mi">14</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">factory</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// UMD from https://github.com/umdjs/umd/blob/master/returnExports.js</span>

  <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">define</span><span class="p">(</span><span class="nx">factory</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">manip</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">}(</span><span class="k">this</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-149" id="section-149">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="manip()">
  <h3>
    <a href="#manip()" name="manip()" class="pilcrow">&#182;</a>
    manip()
  </h3>
</div>

  </div>
  <div class="body"><p>The function to return.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Object} <code>ob</code></strong> The function to apply the Manipulation to.</li>
<li><strong>@param {Object} <code>jsonDoc</code></strong> The manipulation.</li>
<li><strong>@param {Function|undefined} <code>cloneObjFunc</code></strong> Function to use for cloning objects, if left null, it will do a JSON based clone.</li>
<li><strong>@return {Object}</strong> The result of applying the <code>jsonDoc</code> to <code>ob</code>.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">manip</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">jsonDoc</span><span class="p">,</span><span class="nx">cloneFunc</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">_cloneFunc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">ob</span><span class="p">));</span> <span class="p">};</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">cloneFunc</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="nx">_cloneFunc</span><span class="p">(</span><span class="nx">ob</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="nx">cloneFunc</span><span class="p">(</span><span class="nx">ob</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">jsonDoc</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">jsonDoc</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;$&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">manip</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;manip: Does not have manipulation function &#39;</span><span class="o">+</span><span class="nx">k</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="nx">manip</span><span class="p">.</span><span class="nx">fn</span><span class="p">[</span><span class="nx">k</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">)].</span><span class="nx">call</span><span class="p">(</span><span class="nx">manip</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">jsonDoc</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="p">}</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-151" id="section-151">&#182;</a>
</div>
<p>Holds the functions</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">manip</span><span class="p">.</span><span class="nx">fn</span> <span class="o">=</span> <span class="p">{};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="manip._setkey()">
  <h3>
    <a href="#manip._setkey()" name="manip._setkey()" class="pilcrow">&#182;</a>
    manip._setKey()
  </h3>
</div>

  </div>
  <div class="body"><p>Sets an internal field of <code>r</code> at <code>path</code> to <code>value</code>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Object} <code>r</code></strong> The object to set an internal path to.</li>
<li><strong>@param {String} <code>path</code></strong> The path to change, seperated by "."'s.</li>
<li><strong>@param {Var} <code>value</code></strong> The value to set <code>path</code> to.</li>
<li><strong>@return {Object}</strong> The result.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">manip</span><span class="p">.</span><span class="nx">_setKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span>
    <span class="nx">t</span> <span class="o">=</span> <span class="nx">r</span><span class="p">,</span>
    <span class="nx">parsePath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
  
  <span class="k">while</span> <span class="p">(</span><span class="nx">parsePath</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="nx">parsePath</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">parsePath</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="manip._getkey()">
  <h3>
    <a href="#manip._getkey()" name="manip._getkey()" class="pilcrow">&#182;</a>
    manip._getKey()
  </h3>
</div>

  </div>
  <div class="body"><p>Gets the value from <code>r</code> at path <code>path</code>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Object} <code>r</code></strong> The object to set an internal path to.</li>
<li><strong>@param {String} <code>path</code></strong> The path to get, seperated by "."'s.</li>
<li><strong>@return {Object}</strong> The result.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">manip</span><span class="p">.</span><span class="nx">_getKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span>
    <span class="nx">t</span> <span class="o">=</span> <span class="nx">r</span><span class="p">,</span>
    <span class="nx">parsePath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
  
  <span class="k">while</span> <span class="p">(</span><span class="nx">parsePath</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="nx">parsePath</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">parsePath</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>
    <span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="manip._remkey()">
  <h3>
    <a href="#manip._remkey()" name="manip._remkey()" class="pilcrow">&#182;</a>
    manip._remKey()
  </h3>
</div>

  </div>
  <div class="body"><p>Removes <code>path</code> from <code>r</code>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Object} <code>r</code></strong> The object to remove an internal path from.</li>
<li><strong>@param {String} <code>path</code></strong> The path to remove, seperated by "."'s.</li>
<li><strong>@return {Object}</strong> The result</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">manip</span><span class="p">.</span><span class="nx">_remKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span>
    <span class="nx">t</span> <span class="o">=</span> <span class="nx">r</span><span class="p">,</span>
    <span class="nx">parsePath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
  
  <span class="k">while</span> <span class="p">(</span><span class="nx">parsePath</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="nx">parsePath</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">parsePath</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">delete</span> <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="manip.addmanipulation()">
  <h3>
    <a href="#manip.addmanipulation()" name="manip.addmanipulation()" class="pilcrow">&#182;</a>
    manip.addManipulation()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a manipulation function.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>name</code></strong> The name of the Manipulation</li>
<li><strong>@param {Function} <code>func</code></strong> The function that will perform the manipultion</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">manip</span><span class="p">.</span><span class="nx">addManipulation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">manip</span><span class="p">.</span><span class="nx">fn</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-156" id="section-156">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Adds the 'set' which is similar to the MongoDB operation of the same name.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">manip</span><span class="p">.</span><span class="nx">addManipulation</span><span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">jsonSnippet</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">jsonSnippet</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">jsonSnippet</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">ob</span> <span class="o">=</span> <span class="nx">manip</span><span class="p">.</span><span class="nx">_setKey</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">k</span><span class="p">,</span><span class="nx">jsonSnippet</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
  <span class="p">}</span> <span class="p">}</span>
  <span class="k">return</span> <span class="nx">ob</span><span class="p">;</span>
<span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-157" id="section-157">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Adds the 'unset' which is similar to the MongoDB operation of the same name.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">manip</span><span class="p">.</span><span class="nx">addManipulation</span><span class="p">(</span><span class="s1">&#39;unset&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">jsonSnippet</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">jsonSnippet</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">jsonSnippet</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">ob</span> <span class="o">=</span> <span class="nx">manip</span><span class="p">.</span><span class="nx">_remKey</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">k</span><span class="p">);</span>
  <span class="p">}</span> <span class="p">}</span>
  <span class="k">return</span> <span class="nx">ob</span><span class="p">;</span>
<span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-158" id="section-158">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Adds the 'push' which is will add an item or items to the array.</p>
  </div>
  <div class="body"><p>Note the subdocument of jsonSnippet can be a single scalar, which will just
be added to the array or it could be a document including any/all of "$each",
"$sort" and "$slice" which will act in way (somewhat) similar to how they
work in MongoDB 2.4.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">manip</span><span class="p">.</span><span class="nx">addManipulation</span><span class="p">(</span><span class="s1">&#39;push&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">jsonSnippet</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">subOps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;scalar&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">src</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">src</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="s2">&quot;$each&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">val</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">src</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">val</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">src</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="s2">&quot;$sort&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">tmp</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">src</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
      <span class="p">}</span>
      
      <span class="nx">src</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
              <span class="k">return</span> <span class="p">(</span><span class="nx">val</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">b</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
              <span class="k">return</span> <span class="p">(</span><span class="nx">val</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">==</span> <span class="nx">b</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span> <span class="p">{</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
            <span class="nx">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">k</span><span class="p">]].</span><span class="nx">sort</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">a</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span> <span class="p">{</span>
              <span class="k">return</span> <span class="p">(</span><span class="nx">val</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">val</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">src</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="s2">&quot;$slice&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">num</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">[];</span> <span class="p">}</span>
      <span class="k">return</span> <span class="nx">src</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">processPushMods</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">pushMods</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="kd">var</span> <span class="nx">toPush</span> <span class="o">=</span> <span class="p">{},</span>
      <span class="nx">willPush</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">pushMods</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span>
        <span class="nx">pushMods</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="p">(</span><span class="nx">subOps</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span>
      <span class="p">)</span> <span class="p">{</span>
        <span class="nx">v</span> <span class="o">=</span> <span class="nx">subOps</span><span class="p">[</span><span class="nx">k</span><span class="p">](</span><span class="nx">v</span><span class="p">,</span> <span class="nx">pushMods</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">willPush</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">toPush</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">pushMods</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nx">subOps</span><span class="p">.</span><span class="nx">scalar</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">toPush</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">v</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">jsonSnippet</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">jsonSnippet</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
  
    <span class="nx">v</span> <span class="o">=</span> <span class="nx">manip</span><span class="p">.</span><span class="nx">_getKey</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">k</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">v</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ob</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">v</span> <span class="o">=</span> <span class="p">[</span><span class="nx">ob</span><span class="p">[</span><span class="nx">k</span><span class="p">]];</span>
    <span class="p">}</span>
    
    <span class="nx">v</span> <span class="o">=</span> <span class="nx">processPushMods</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">jsonSnippet</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
    
    <span class="nx">ob</span> <span class="o">=</span> <span class="nx">manip</span><span class="p">.</span><span class="nx">_setKey</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">);</span>
  <span class="p">}</span> <span class="p">}</span>
  <span class="k">return</span> <span class="nx">ob</span><span class="p">;</span>
<span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-159" id="section-159">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Adds the 'inc' which is similar to the MongoDB operation of the same name.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">manip</span><span class="p">.</span><span class="nx">addManipulation</span><span class="p">(</span><span class="s1">&#39;inc&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">jsonSnippet</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">jsonSnippet</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">jsonSnippet</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">manip</span><span class="p">.</span><span class="nx">_getKey</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">k</span><span class="p">),</span><span class="mi">10</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">jsonSnippet</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
    <span class="nx">ob</span> <span class="o">=</span> <span class="nx">manip</span><span class="p">.</span><span class="nx">_setKey</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">k</span><span class="p">,</span><span class="nx">x</span><span class="p">);</span>
  <span class="p">}</span> <span class="p">}</span>
  <span class="k">return</span> <span class="nx">ob</span><span class="p">;</span>
<span class="p">});</span>

<span class="k">return</span> <span class="nx">manip</span><span class="p">;</span>

<span class="p">}));</span>

<span class="p">},{}],</span><span class="mi">15</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">_dereq_</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">manip</span><span class="p">)</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-160" id="section-160">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="updateresult()">
  <h3>
    <a href="#updateresult()" name="updateresult()" class="pilcrow">&#182;</a>
    updateResult()
  </h3>
</div>

  </div>
  <div class="body"><p>Runs a <code>Pathitem</code> on a <code>PathRoot</code> or a <code>PathRoot</code> with one or more <code>Pathitem</code> already ran on it.</p>

<p><strong>Parameters</strong></p>

<ul>
<li><strong>@param {PathRoot|updateResult(PathRoot,Pathitem)} <code>obToApplyTo</code></strong></li>
<li><strong>@param {Pathitem} <code>pathitem</code></strong></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">updateResult</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obToApplyTo</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">,</span><span class="nx">cloningFunction</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">updateResult</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_op_&#39;</span><span class="o">+</span><span class="nx">pathitem</span><span class="p">.</span><span class="nx">o</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span>
      <span class="s1">&#39;SyncLib.updateResult No Operation: updateResult has no &#39;</span> <span class="o">+</span>
      <span class="s1">&#39;operation &#39;</span><span class="o">+</span>
      <span class="nx">pathitem</span><span class="p">.</span><span class="nx">o</span>
    <span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">updateResult</span><span class="p">[</span><span class="s1">&#39;_op_&#39;</span><span class="o">+</span><span class="nx">pathitem</span><span class="p">.</span><span class="nx">o</span><span class="p">];</span>
  <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">obToApplyTo</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">,</span><span class="nx">cloningFunction</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="updateresult.op_update()">
  <h3>
    <a href="#updateresult.op_update()" name="updateresult.op_update()" class="pilcrow">&#182;</a>
    updateResult.op_update()
  </h3>
</div>

  </div>
  <div class="body"><p>Performs a MongoDB like update operation.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Object} <code>ob</code></strong> The Object to update</li>
<li><strong>@param {Object} <code>pathitem</code></strong> The <em>Pathitem</em> to apply</li>
<li><strong>@param {Function} <code>cloningFunction</code></strong> The function to use to create a clone of <code>ob</code></li>
<li><strong>@return {Object}</strong> The result.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">updateResult</span><span class="p">.</span><span class="nx">_op_update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">,</span><span class="nx">cloningFunction</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">cloningFunction</span><span class="p">(</span><span class="nx">ob</span><span class="p">);</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">manip</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">i</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">.</span><span class="nx">u</span><span class="p">,</span><span class="nx">cloningFunction</span><span class="p">);</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">v</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">pathitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">pathitem</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">pathitem</span><span class="p">.</span><span class="nx">t</span><span class="p">;</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="updateresult.op_removedata()">
  <h3>
    <a href="#updateresult.op_removedata()" name="updateresult.op_removedata()" class="pilcrow">&#182;</a>
    updateResult.op_removeData()
  </h3>
</div>

  </div>
  <div class="body"><p>Remove operations set the removed flag, increment the version and set the 
<em>modifier</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Object} <code>ob</code></strong> The Object to update</li>
<li><strong>@param {Object} <code>pathitem</code></strong> The Pathitem to be applied</li>
<li><strong>@param {Function} <code>cloningFunction</code></strong> The function to use to create a clone of <code>ob</code></li>
<li><strong>@return {Object}</strong> The result</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">updateResult</span><span class="p">.</span><span class="nx">_op_remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">,</span><span class="nx">cloningFunction</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">cloningFunction</span><span class="p">(</span><span class="nx">ob</span><span class="p">);</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">v</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">pathitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">pathitem</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">pathitem</span><span class="p">.</span><span class="nx">t</span><span class="p">;</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="updateresult.op_set()">
  <h3>
    <a href="#updateresult.op_set()" name="updateresult.op_set()" class="pilcrow">&#182;</a>
    updateResult.op_set()
  </h3>
</div>

  </div>
  <div class="body"><p>A set operation is a local <em>Operation</em> which will overwrite all data. The 
version will be incremented, <em>Modifier</em> set and the removed flag will be unset.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Object} <code>ob</code></strong> The Object to update</li>
<li><strong>@param {Object} <code>pathitem</code></strong> The Pathitem to be applied</li>
<li><strong>@param {Function} <code>cloningFunction</code></strong> The function to use to create a clone of <code>ob</code></li>
<li><strong>@return {Object}</strong> The result</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">updateResult</span><span class="p">.</span><span class="nx">_op_set</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">,</span><span class="nx">pathitem</span><span class="p">,</span><span class="nx">cloningFunction</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">cloningFunction</span><span class="p">(</span><span class="nx">ob</span><span class="p">);</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">pathitem</span><span class="p">.</span><span class="nx">u</span><span class="p">;</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">v</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">pathitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">pathitem</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">pathitem</span><span class="p">.</span><span class="nx">t</span><span class="p">;</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">return</span> <span class="nx">updateResult</span><span class="p">;</span>

<span class="p">}(</span><span class="nx">_dereq_</span><span class="p">(</span><span class="s1">&#39;manip&#39;</span><span class="p">)));</span>

<span class="p">},{</span><span class="s2">&quot;manip&quot;</span><span class="o">:</span><span class="mi">14</span><span class="p">}]},{},[</span><span class="mi">9</span><span class="p">])</span>
<span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="p">});</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
